<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Web3 수익 가계부</title>
    <script src="https://cdn.jsdelivr.net/npm/chart.js@4.4.1/dist/chart.umd.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/chart.js@4.4.1/dist/chart.umd.min.js"></script>
    <style>
        :root {
            /* Primary Colors */
            --primary: #667eea;
            --primary-light: #9f7aea;
            --primary-dark: #5a67d8;

            /* Account Colors */
            --web3: #667eea;
            --investment: #3182ce;
            --bank: #38a169;
            --family: #ed8936;

            /* Transaction Colors */
            --income: #48bb78;
            --expense: #f56565;
            --transfer: #4299e1;

            /* Status Colors */
            --success: #48bb78;
            --warning: #ed8936;
            --danger: #f56565;
            --info: #4299e1;

            /* Neutral Colors */
            --gray-50: #f7fafc;
            --gray-100: #edf2f7;
            --gray-200: #e2e8f0;
            --gray-300: #cbd5e0;
            --gray-400: #a0aec0;
            --gray-500: #718096;
            --gray-600: #4a5568;
            --gray-700: #2d3748;
            --gray-800: #1a202c;
            --gray-900: #171923;

            /* RPG Colors */
            --rpg-red: #dc3545;
            --rpg-gold: #ffc107;
            --rpg-purple: #9c27b0;

            /* Spacing */
            --space-1: 0.25rem;
            --space-2: 0.5rem;
            --space-3: 0.75rem;
            --space-4: 1rem;
            --space-5: 1.25rem;
            --space-6: 1.5rem;
            --space-8: 2rem;
            --space-10: 2.5rem;
            --space-12: 3rem;

            /* Border Radius */
            --radius-sm: 0.375rem;
            --radius-md: 0.5rem;
            --radius-lg: 0.75rem;
            --radius-xl: 1rem;
            --radius-2xl: 1.5rem;
            --radius-full: 9999px;

            /* Shadows */
            --shadow-sm: 0 1px 2px 0 rgba(0, 0, 0, 0.05);
            --shadow: 0 1px 3px 0 rgba(0, 0, 0, 0.1), 0 1px 2px 0 rgba(0, 0, 0, 0.06);
            --shadow-md: 0 4px 6px -1px rgba(0, 0, 0, 0.1), 0 2px 4px -1px rgba(0, 0, 0, 0.06);
            --shadow-lg: 0 10px 15px -3px rgba(0, 0, 0, 0.1), 0 4px 6px -2px rgba(0, 0, 0, 0.05);
            --shadow-xl: 0 20px 25px -5px rgba(0, 0, 0, 0.1), 0 10px 10px -5px rgba(0, 0, 0, 0.04);

            /* Typography */
            --text-xs: 0.75rem;
            --text-sm: 0.875rem;
            --text-base: 1rem;
            --text-lg: 1.125rem;
            --text-xl: 1.25rem;
            --text-2xl: 1.5rem;
            --text-3xl: 1.875rem;
            --text-4xl: 2.25rem;

            /* Font Weights */
            --font-normal: 400;
            --font-medium: 500;
            --font-semibold: 600;
            --font-bold: 700;

            /* Transitions */
            --transition-fast: 150ms ease-in-out;
            --transition-base: 200ms ease-in-out;
            --transition-slow: 300ms ease-in-out;
        }

        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            padding: 20px;
        }

        .container {
            max-width: 1200px;
            margin: 0 auto;
            background: white;
            border-radius: 20px;
            padding: 30px;
            box-shadow: 0 20px 60px rgba(0,0,0,0.3);
        }

        h1 {
            text-align: center;
            color: #667eea;
            margin-bottom: 10px;
            font-size: 2em;
        }

        .subtitle {
            text-align: center;
            color: #666;
            margin-bottom: 30px;
        }

        .tab-navigation {
            display: flex;
            gap: 10px;
            margin-bottom: 30px;
            border-bottom: 2px solid #f0f0f0;
        }

        .tab-button {
            padding: 12px 25px;
            background: none;
            border: none;
            border-bottom: 3px solid transparent;
            color: #666;
            font-size: 1em;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s;
        }

        .tab-button:hover {
            color: #667eea;
        }

        .tab-button.active {
            color: #667eea;
            border-bottom-color: #667eea;
        }

        .tab-content {
            display: none;
        }

        .tab-content.active {
            display: block;
        }

        .subtitle {
            text-align: center;
            color: #666;
            margin-bottom: 30px;
        }

        .summary {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 20px;
            margin-bottom: 30px;
        }

        .summary-card {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            padding: 20px;
            border-radius: 15px;
            text-align: center;
        }

        .summary-card.income {
            background: linear-gradient(135deg, #11998e 0%, #38ef7d 100%);
        }

        .summary-card.expense {
            background: linear-gradient(135deg, #ee0979 0%, #ff6a00 100%);
        }

        .summary-card h3 {
            font-size: 0.9em;
            margin-bottom: 10px;
            opacity: 0.9;
        }

        .summary-card .amount {
            font-size: 2em;
            font-weight: bold;
        }

        .input-section {
            background: #f8f9fa;
            padding: 25px;
            border-radius: 15px;
            margin-bottom: 30px;
        }

        .input-section h2 {
            color: #667eea;
            margin-bottom: 20px;
            font-size: 1.3em;
        }

        .form-group {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 15px;
            margin-bottom: 15px;
        }

        .form-group label {
            display: block;
            margin-bottom: 5px;
            color: #333;
            font-weight: 500;
        }

        .form-group input,
        .form-group select {
            width: 100%;
            padding: 10px;
            border: 2px solid #ddd;
            border-radius: 8px;
            font-size: 1em;
            transition: border-color 0.3s;
        }

        .form-group input:focus,
        .form-group select:focus {
            outline: none;
            border-color: #667eea;
        }

        .btn {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            padding: 12px 30px;
            border: none;
            border-radius: 8px;
            cursor: pointer;
            font-size: 1em;
            font-weight: bold;
            transition: transform 0.2s;
        }

        .btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 5px 15px rgba(102, 126, 234, 0.4);
        }

        .btn-delete {
            background: linear-gradient(135deg, #ee0979 0%, #ff6a00 100%);
            padding: 5px 15px;
            font-size: 0.9em;
        }

        .transactions {
            margin-top: 30px;
        }

        .transactions h2 {
            color: #667eea;
            margin-bottom: 20px;
            font-size: 1.3em;
        }

        .transaction-list {
            display: flex;
            flex-direction: column;
            gap: 10px;
        }

        .transaction-item {
            background: white;
            border: 2px solid #f0f0f0;
            padding: 15px;
            border-radius: 10px;
            display: flex;
            justify-content: space-between;
            align-items: center;
            transition: all 0.3s;
        }

        .transaction-item:hover {
            border-color: #667eea;
            box-shadow: 0 5px 15px rgba(0,0,0,0.1);
        }

        .transaction-item.income {
            border-left: 5px solid #38ef7d;
        }

        .transaction-item.expense {
            border-left: 5px solid #ff6a00;
        }

        .transaction-info {
            flex: 1;
        }

        .transaction-category {
            display: inline-block;
            background: #667eea;
            color: white;
            padding: 3px 10px;
            border-radius: 15px;
            font-size: 0.85em;
            margin-right: 10px;
        }

        .transaction-description {
            color: #666;
            margin-top: 5px;
            font-size: 0.9em;
        }

        .transaction-amount {
            font-size: 1.3em;
            font-weight: bold;
            margin-right: 15px;
        }

        .transaction-amount.income {
            color: #11998e;
        }

        .transaction-amount.expense {
            color: #ee0979;
        }

        .transaction-date {
            color: #999;
            font-size: 0.85em;
            margin-right: 15px;
        }

        .filter-section {
            background: #f8f9fa;
            padding: 15px;
            border-radius: 10px;
            margin-bottom: 20px;
            display: flex;
            gap: 15px;
            flex-wrap: wrap;
            align-items: center;
        }

        .filter-section select {
            padding: 8px;
            border: 2px solid #ddd;
            border-radius: 8px;
            font-size: 0.9em;
        }

        .date-filter {
            background: white;
            padding: 15px;
            border-radius: 10px;
            margin-bottom: 20px;
            display: flex;
            gap: 10px;
            flex-wrap: wrap;
            align-items: center;
            border: 2px solid #f0f0f0;
        }

        .date-filter label {
            font-weight: 600;
            color: #667eea;
        }

        .date-filter-btn {
            padding: 8px 16px;
            background: white;
            border: 2px solid #ddd;
            border-radius: 8px;
            cursor: pointer;
            font-size: 0.9em;
            transition: all 0.3s;
        }

        .date-filter-btn:hover {
            border-color: #667eea;
            color: #667eea;
        }

        .date-filter-btn.active {
            background: #667eea;
            color: white;
            border-color: #667eea;
        }

        .stats-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 15px;
            margin-bottom: 30px;
        }

        .stat-card {
            background: white;
            padding: 15px;
            border-radius: 10px;
            border-left: 4px solid #667eea;
        }

        .stat-card h4 {
            color: #666;
            font-size: 0.9em;
            margin-bottom: 8px;
        }

        .stat-card .stat-value {
            font-size: 1.5em;
            font-weight: bold;
            color: #333;
        }

        .stat-card .stat-change {
            font-size: 0.85em;
            margin-top: 5px;
        }

        .stat-change.positive {
            color: #11998e;
        }

        .stat-change.negative {
            color: #ee0979;
        }

        .action-buttons {
            display: flex;
            gap: 10px;
            margin-bottom: 20px;
            flex-wrap: wrap;
        }

        .btn-secondary {
            background: white;
            color: #667eea;
            border: 2px solid #667eea;
        }

        .btn-secondary:hover {
            background: #667eea;
            color: white;
        }

        .dynamic-fields {
            background: #f0f4ff;
            padding: 20px;
            border-radius: 10px;
            margin-top: 15px;
            border-left: 4px solid #667eea;
        }

        .dynamic-fields h3 {
            color: #667eea;
            font-size: 1em;
            margin-bottom: 15px;
            display: flex;
            align-items: center;
            gap: 8px;
        }

        .field-hint {
            font-size: 0.85em;
            color: #666;
            margin-top: 3px;
        }

        .calculated-value {
            background: white;
            padding: 15px;
            border-radius: 8px;
            margin-top: 10px;
            text-align: center;
            border: 2px solid #667eea;
        }

        .calculated-value label {
            display: block;
            color: #666;
            font-size: 0.9em;
            margin-bottom: 5px;
        }

        .calculated-value .value {
            font-size: 1.8em;
            font-weight: bold;
            color: #11998e;
        }

        .token-badge {
            display: inline-block;
            background: #667eea;
            color: white;
            padding: 2px 8px;
            border-radius: 12px;
            font-size: 0.8em;
            margin-left: 8px;
        }

        .btn-edit {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            padding: 5px 15px;
            font-size: 0.9em;
            margin-right: 5px;
        }

        .edit-mode {
            background: #fff3cd !important;
            border: 2px solid #ffc107 !important;
        }

        .edit-mode-banner {
            background: linear-gradient(135deg, #ffc107 0%, #ff9800 100%);
            color: white;
            padding: 15px;
            border-radius: 10px;
            margin-bottom: 15px;
            text-align: center;
            font-weight: 600;
            display: none;
        }

        .edit-mode-banner.active {
            display: block;
        }

        /* RPG 스타일 */
        .rpg-container {
            max-width: 900px;
            margin: 0 auto;
        }

        .boss-card {
            background: white;
            border-radius: 15px;
            padding: 30px;
            margin-bottom: 25px;
            box-shadow: 0 5px 20px rgba(0,0,0,0.1);
            transition: all 0.3s;
        }

        .boss-card:hover {
            transform: translateY(-5px);
            box-shadow: 0 10px 30px rgba(0,0,0,0.15);
        }

        .boss-card.futures {
            border: 3px solid #dc3545;
            background: linear-gradient(135deg, #fff5f5 0%, #ffffff 100%);
        }

        .boss-card.debt {
            border: 3px solid #ff9800;
            background: linear-gradient(135deg, #fff8f0 0%, #ffffff 100%);
        }

        .boss-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 20px;
            padding-bottom: 15px;
            border-bottom: 2px solid #f0f0f0;
        }

        .boss-title {
            font-size: 1.8em;
            font-weight: bold;
            color: #333;
        }

        .boss-title.danger {
            color: #dc3545;
        }

        .streak-display {
            text-align: center;
            padding: 30px;
            background: linear-gradient(135deg, #dc3545 0%, #c82333 100%);
            border-radius: 15px;
            color: white;
            margin: 20px 0;
        }

        .streak-number {
            font-size: 4em;
            font-weight: bold;
            line-height: 1;
            text-shadow: 2px 2px 4px rgba(0,0,0,0.3);
        }

        .streak-label {
            font-size: 1.2em;
            margin-top: 10px;
            opacity: 0.9;
        }

        .max-streak {
            margin-top: 15px;
            font-size: 1em;
            opacity: 0.8;
        }

        .reset-button {
            background: linear-gradient(135deg, #dc3545 0%, #c82333 100%);
            color: white;
            padding: 15px 30px;
            border: none;
            border-radius: 10px;
            font-size: 1.1em;
            font-weight: bold;
            cursor: pointer;
            width: 100%;
            margin-top: 20px;
            transition: all 0.3s;
        }

        .reset-button:hover {
            background: linear-gradient(135deg, #c82333 0%, #bd2130 100%);
            transform: translateY(-2px);
            box-shadow: 0 5px 15px rgba(220, 53, 69, 0.4);
        }

        .hp-bar-container {
            margin: 20px 0;
        }

        .hp-bar-label {
            display: flex;
            justify-content: space-between;
            margin-bottom: 8px;
            font-weight: 600;
            color: #333;
        }

        .hp-bar {
            width: 100%;
            height: 30px;
            background: #f0f0f0;
            border-radius: 15px;
            overflow: hidden;
            position: relative;
        }

        .hp-bar-fill {
            height: 100%;
            background: linear-gradient(90deg, #dc3545 0%, #ff6b6b 100%);
            transition: width 0.5s ease;
            display: flex;
            align-items: center;
            justify-content: center;
            color: white;
            font-weight: bold;
        }

        .hp-bar-fill.good {
            background: linear-gradient(90deg, #28a745 0%, #5cb85c 100%);
        }

        .hp-bar-fill.medium {
            background: linear-gradient(90deg, #ffc107 0%, #ffdb4d 100%);
        }

        .debt-info {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 15px;
            margin-top: 15px;
        }

        .debt-stat {
            background: #f8f9fa;
            padding: 15px;
            border-radius: 10px;
            text-align: center;
        }

        .debt-stat-label {
            font-size: 0.9em;
            color: #666;
            margin-bottom: 5px;
        }

        .debt-stat-value {
            font-size: 1.5em;
            font-weight: bold;
            color: #333;
        }

        .daily-quests {
            background: white;
            border-radius: 15px;
            padding: 25px;
            box-shadow: 0 5px 20px rgba(0,0,0,0.1);
        }

        .daily-quests h2 {
            color: #667eea;
            margin-bottom: 20px;
            font-size: 1.5em;
        }

        .quest-item {
            background: #f8f9fa;
            padding: 15px 20px;
            border-radius: 10px;
            margin-bottom: 12px;
            display: flex;
            align-items: center;
            cursor: pointer;
            transition: all 0.3s;
            border: 2px solid transparent;
        }

        .quest-item:hover {
            background: #e9ecef;
            transform: translateX(5px);
        }

        .quest-item.completed {
            background: linear-gradient(135deg, #d4edda 0%, #c3e6cb 100%);
            border-color: #28a745;
        }

        .quest-checkbox {
            width: 24px;
            height: 24px;
            border: 3px solid #667eea;
            border-radius: 6px;
            margin-right: 15px;
            display: flex;
            align-items: center;
            justify-content: center;
            transition: all 0.3s;
        }

        .quest-item.completed .quest-checkbox {
            background: #28a745;
            border-color: #28a745;
        }

        .quest-checkbox::after {
            content: '✓';
            color: white;
            font-size: 1.2em;
            font-weight: bold;
            display: none;
        }

        .quest-item.completed .quest-checkbox::after {
            display: block;
        }

        .quest-text {
            flex: 1;
            font-size: 1.1em;
            font-weight: 500;
            color: #333;
        }

        .main-quest {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            border-radius: 15px;
            padding: 30px;
            margin-bottom: 30px;
            box-shadow: 0 10px 30px rgba(102, 126, 234, 0.3);
        }

        .main-quest h2 {
            font-size: 2em;
            margin-bottom: 20px;
            text-shadow: 2px 2px 4px rgba(0,0,0,0.2);
        }

        .main-quest-progress {
            background: rgba(255,255,255,0.2);
            height: 40px;
            border-radius: 20px;
            overflow: hidden;
            margin: 15px 0;
        }

        .main-quest-fill {
            height: 100%;
            background: linear-gradient(90deg, #28a745 0%, #5cb85c 100%);
            display: flex;
            align-items: center;
            justify-content: center;
            font-weight: bold;
            transition: width 0.5s ease;
        }

        .main-quest-stats {
            display: flex;
            justify-content: space-between;
            margin-top: 15px;
            font-size: 1.1em;
        }

        /* 홈 대시보드 스타일 */
        .home-container {
            max-width: 1400px;
            margin: 0 auto;
            padding: var(--space-6);
        }

        .home-grid {
            display: grid;
            gap: var(--space-6);
        }

        /* 총 자산 카드 - 대형 */
        .total-assets-card {
            background: linear-gradient(135deg, var(--primary) 0%, var(--primary-dark) 100%);
            color: white;
            border-radius: var(--radius-2xl);
            padding: var(--space-8);
            box-shadow: var(--shadow-xl);
            transition: transform var(--transition-base);
        }

        .total-assets-card:hover {
            transform: translateY(-4px);
        }

        .total-assets-label {
            font-size: var(--text-lg);
            opacity: 0.9;
            margin-bottom: var(--space-2);
            font-weight: var(--font-medium);
        }

        .total-assets-value {
            font-size: var(--text-4xl);
            font-weight: var(--font-bold);
            margin-bottom: var(--space-3);
            line-height: 1.2;
        }

        .total-assets-change {
            display: flex;
            align-items: center;
            gap: var(--space-2);
            font-size: var(--text-lg);
            opacity: 0.95;
        }

        .change-positive {
            color: #a7f3d0;
        }

        .change-negative {
            color: #fecaca;
        }

        /* 3열 그리드 - 수입/지출/순수익 */
        .metrics-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: var(--space-4);
        }

        .metric-card {
            background: white;
            border-radius: var(--radius-xl);
            padding: var(--space-6);
            box-shadow: var(--shadow-md);
            transition: all var(--transition-base);
            border: 2px solid transparent;
        }

        .metric-card:hover {
            transform: translateY(-2px);
            box-shadow: var(--shadow-lg);
            border-color: var(--gray-200);
        }

        .metric-card.income {
            border-left: 4px solid var(--income);
        }

        .metric-card.expense {
            border-left: 4px solid var(--expense);
        }

        .metric-card.profit {
            border-left: 4px solid var(--info);
        }

        .metric-header {
            display: flex;
            align-items: center;
            gap: var(--space-2);
            margin-bottom: var(--space-3);
        }

        .metric-icon {
            font-size: var(--text-2xl);
        }

        .metric-label {
            font-size: var(--text-sm);
            color: var(--gray-600);
            font-weight: var(--font-medium);
        }

        .metric-value {
            font-size: var(--text-3xl);
            font-weight: var(--font-bold);
            margin-bottom: var(--space-2);
        }

        .metric-value.income-color {
            color: var(--income);
        }

        .metric-value.expense-color {
            color: var(--expense);
        }

        .metric-value.profit-color {
            color: var(--info);
        }

        .metric-detail {
            font-size: var(--text-sm);
            color: var(--gray-500);
        }

        .metric-action {
            margin-top: var(--space-3);
            padding-top: var(--space-3);
            border-top: 1px solid var(--gray-200);
        }

        .metric-link {
            font-size: var(--text-sm);
            color: var(--primary);
            text-decoration: none;
            font-weight: var(--font-medium);
            transition: color var(--transition-fast);
        }

        .metric-link:hover {
            color: var(--primary-dark);
        }

        /* 자산 분포 카드 */
        .asset-distribution-card {
            background: white;
            border-radius: var(--radius-xl);
            padding: var(--space-6);
            box-shadow: var(--shadow-md);
        }

        .card-title {
            font-size: var(--text-xl);
            font-weight: var(--font-bold);
            color: var(--gray-800);
            margin-bottom: var(--space-5);
            display: flex;
            align-items: center;
            gap: var(--space-2);
        }

        .asset-item {
            display: flex;
            align-items: center;
            gap: var(--space-4);
            padding: var(--space-4);
            border-radius: var(--radius-lg);
            transition: background var(--transition-fast);
            margin-bottom: var(--space-3);
        }

        .asset-item:hover {
            background: var(--gray-50);
        }

        .asset-icon {
            font-size: var(--text-2xl);
            width: 48px;
            height: 48px;
            display: flex;
            align-items: center;
            justify-content: center;
            border-radius: var(--radius-lg);
            background: var(--gray-100);
        }

        .asset-icon.web3 { background: rgba(102, 126, 234, 0.1); }
        .asset-icon.investment { background: rgba(49, 130, 206, 0.1); }
        .asset-icon.bank { background: rgba(56, 161, 105, 0.1); }

        .asset-info {
            flex: 1;
        }

        .asset-name {
            font-size: var(--text-base);
            font-weight: var(--font-semibold);
            color: var(--gray-800);
            margin-bottom: var(--space-1);
        }

        .asset-bar-container {
            display: flex;
            align-items: center;
            gap: var(--space-3);
        }

        .asset-bar {
            flex: 1;
            height: 8px;
            background: var(--gray-200);
            border-radius: var(--radius-full);
            overflow: hidden;
        }

        .asset-bar-fill {
            height: 100%;
            border-radius: var(--radius-full);
            transition: width var(--transition-slow);
        }

        .asset-bar-fill.web3 { background: var(--web3); }
        .asset-bar-fill.investment { background: var(--investment); }
        .asset-bar-fill.bank { background: var(--bank); }

        .asset-percent {
            font-size: var(--text-sm);
            font-weight: var(--font-semibold);
            color: var(--gray-600);
            min-width: 45px;
            text-align: right;
        }

        .asset-amount {
            font-size: var(--text-lg);
            font-weight: var(--font-bold);
            color: var(--gray-800);
            min-width: 120px;
            text-align: right;
        }

        /* 빠른 액션 */
        .quick-actions-card {
            background: white;
            border-radius: var(--radius-xl);
            padding: var(--space-6);
            box-shadow: var(--shadow-md);
        }

        .quick-actions-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(140px, 1fr));
            gap: var(--space-3);
        }

        .quick-action-btn {
            display: flex;
            flex-direction: column;
            align-items: center;
            gap: var(--space-2);
            padding: var(--space-4);
            background: var(--gray-50);
            border: 2px solid var(--gray-200);
            border-radius: var(--radius-lg);
            cursor: pointer;
            transition: all var(--transition-fast);
            text-decoration: none;
            color: var(--gray-700);
        }

        .quick-action-btn:hover {
            background: var(--primary);
            border-color: var(--primary);
            color: white;
            transform: translateY(-2px);
            box-shadow: var(--shadow-md);
        }

        .quick-action-icon {
            font-size: var(--text-3xl);
        }

        .quick-action-label {
            font-size: var(--text-sm);
            font-weight: var(--font-semibold);
        }

        /* 자금 흐름 카드 */
        .cashflow-card {
            background: white;
            border-radius: var(--radius-xl);
            padding: var(--space-6);
            box-shadow: var(--shadow-md);
        }

        .cashflow-section {
            margin-bottom: var(--space-6);
        }

        .cashflow-section:last-child {
            margin-bottom: 0;
        }

        .cashflow-section-title {
            font-size: var(--text-lg);
            font-weight: var(--font-bold);
            color: var(--gray-800);
            margin-bottom: var(--space-4);
            display: flex;
            align-items: center;
            gap: var(--space-2);
        }

        .cashflow-item {
            display: flex;
            align-items: center;
            justify-content: space-between;
            padding: var(--space-3) 0;
            border-bottom: 1px solid var(--gray-100);
        }

        .cashflow-item:last-child {
            border-bottom: none;
        }

        .cashflow-item-left {
            display: flex;
            align-items: center;
            gap: var(--space-3);
            flex: 1;
        }

        .cashflow-rank {
            width: 24px;
            height: 24px;
            background: var(--gray-200);
            border-radius: var(--radius-full);
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: var(--text-sm);
            font-weight: var(--font-bold);
            color: var(--gray-600);
        }

        .cashflow-rank.top1 {
            background: linear-gradient(135deg, #ffd700, #ffed4e);
            color: #995700;
        }

        .cashflow-rank.top2 {
            background: linear-gradient(135deg, #c0c0c0, #e8e8e8);
            color: #666;
        }

        .cashflow-rank.top3 {
            background: linear-gradient(135deg, #cd7f32, #e8a87c);
            color: #5c3a1a;
        }

        .cashflow-name {
            font-size: var(--text-base);
            font-weight: var(--font-medium);
            color: var(--gray-700);
        }

        .cashflow-amount {
            font-size: var(--text-lg);
            font-weight: var(--font-bold);
            color: var(--gray-800);
            margin-right: var(--space-2);
        }

        .cashflow-amount.income {
            color: var(--income);
        }

        .cashflow-amount.expense {
            color: var(--expense);
        }

        .cashflow-percent {
            font-size: var(--text-sm);
            color: var(--gray-500);
            background: var(--gray-100);
            padding: var(--space-1) var(--space-2);
            border-radius: var(--radius-md);
        }

        .cashflow-bar-container {
            height: 6px;
            background: var(--gray-200);
            border-radius: var(--radius-full);
            overflow: hidden;
            margin-left: 40px;
            margin-top: var(--space-2);
        }

        .cashflow-bar {
            height: 100%;
            border-radius: var(--radius-full);
            transition: width var(--transition-slow);
        }

        .cashflow-bar.income {
            background: linear-gradient(90deg, var(--income), #68d391);
        }

        .cashflow-bar.expense {
            background: linear-gradient(90deg, var(--expense), #fc8181);
        }

        .insights-section {
            background: linear-gradient(135deg, #f0f4ff, #e6f2ff);
            border-radius: var(--radius-lg);
            padding: var(--space-5);
            margin-top: var(--space-5);
        }

        .insight-item {
            display: flex;
            align-items: flex-start;
            gap: var(--space-3);
            margin-bottom: var(--space-3);
            padding: var(--space-3);
            background: white;
            border-radius: var(--radius-md);
        }

        .insight-item:last-child {
            margin-bottom: 0;
        }

        .insight-icon {
            font-size: var(--text-xl);
            flex-shrink: 0;
        }

        .insight-text {
            font-size: var(--text-sm);
            color: var(--gray-700);
            line-height: 1.5;
        }

        .insight-highlight {
            font-weight: var(--font-semibold);
            color: var(--primary);
        }

        .insight-warning {
            color: var(--warning);
        }

        .insight-danger {
            color: var(--danger);
        }

        .cashflow-summary {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: var(--space-4);
            background: var(--gray-50);
            border-radius: var(--radius-lg);
            margin-top: var(--space-4);
        }

        .summary-label {
            font-size: var(--text-sm);
            color: var(--gray-600);
            font-weight: var(--font-medium);
        }

        .summary-value {
            font-size: var(--text-xl);
            font-weight: var(--font-bold);
        }

        .summary-value.positive {
            color: var(--income);
        }

        .summary-value.negative {
            color: var(--expense);
        }

        /* 차트 컨테이너 */
        .chart-card {
            background: white;
            border-radius: var(--radius-xl);
            padding: var(--space-6);
            box-shadow: var(--shadow-md);
        }

        .chart-container {
            position: relative;
            height: 300px;
            margin-top: var(--space-4);
        }

        .chart-container.small {
            height: 200px;
        }

        .chart-legend {
            display: flex;
            flex-wrap: wrap;
            gap: var(--space-4);
            margin-top: var(--space-4);
            justify-content: center;
        }

        .legend-item {
            display: flex;
            align-items: center;
            gap: var(--space-2);
            font-size: var(--text-sm);
        }

        .legend-color {
            width: 16px;
            height: 16px;
            border-radius: var(--radius-sm);
        }

        .no-data-message {
            text-align: center;
            color: var(--gray-500);
            padding: var(--space-8);
            font-size: var(--text-base);
        }

        /* 2열 그리드 (차트용) */
        .charts-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(400px, 1fr));
            gap: var(--space-6);
        }

        @media (max-width: 768px) {
            .charts-grid {
                grid-template-columns: 1fr;
            }

            .chart-container {
                height: 250px;
            }
        }

        /* 고정 항목 스타일 */
        .recurring-container {
            max-width: 1200px;
            margin: 0 auto;
            padding: var(--space-6);
        }

        .recurring-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: var(--space-6);
            flex-wrap: wrap;
            gap: var(--space-4);
        }

        .recurring-actions {
            display: flex;
            gap: var(--space-3);
        }

        .btn-add {
            padding: var(--space-3) var(--space-5);
            border: none;
            border-radius: var(--radius-lg);
            font-weight: var(--font-semibold);
            cursor: pointer;
            transition: all var(--transition-base);
            font-size: var(--text-sm);
        }

        .btn-add.income {
            background: linear-gradient(135deg, var(--income), #68d391);
            color: white;
        }

        .btn-add.expense {
            background: linear-gradient(135deg, var(--expense), #fc8181);
            color: white;
        }

        .btn-add:hover {
            transform: translateY(-2px);
            box-shadow: var(--shadow-md);
        }

        .recurring-section {
            background: white;
            border-radius: var(--radius-xl);
            padding: var(--space-6);
            margin-bottom: var(--space-6);
            box-shadow: var(--shadow-md);
        }

        .recurring-section-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: var(--space-5);
            padding-bottom: var(--space-4);
            border-bottom: 2px solid var(--gray-200);
        }

        .recurring-section-title {
            font-size: var(--text-xl);
            font-weight: var(--font-bold);
            color: var(--gray-800);
            display: flex;
            align-items: center;
            gap: var(--space-2);
        }

        .recurring-total {
            font-size: var(--text-lg);
            font-weight: var(--font-bold);
        }

        .recurring-total.income {
            color: var(--income);
        }

        .recurring-total.expense {
            color: var(--expense);
        }

        .recurring-item {
            display: flex;
            align-items: center;
            justify-content: space-between;
            padding: var(--space-4);
            background: var(--gray-50);
            border-radius: var(--radius-lg);
            margin-bottom: var(--space-3);
            transition: all var(--transition-base);
            border-left: 4px solid transparent;
        }

        .recurring-item:hover {
            background: var(--gray-100);
            transform: translateX(4px);
        }

        .recurring-item.income {
            border-left-color: var(--income);
        }

        .recurring-item.expense {
            border-left-color: var(--expense);
        }

        .recurring-item-left {
            flex: 1;
        }

        .recurring-item-name {
            font-size: var(--text-lg);
            font-weight: var(--font-semibold);
            color: var(--gray-800);
            margin-bottom: var(--space-2);
        }

        .recurring-item-details {
            display: flex;
            gap: var(--space-4);
            flex-wrap: wrap;
            font-size: var(--text-sm);
            color: var(--gray-600);
        }

        .recurring-detail {
            display: flex;
            align-items: center;
            gap: var(--space-1);
        }

        .recurring-item-right {
            display: flex;
            align-items: center;
            gap: var(--space-4);
        }

        .recurring-amount {
            font-size: var(--text-2xl);
            font-weight: var(--font-bold);
            min-width: 120px;
            text-align: right;
        }

        .recurring-amount.income {
            color: var(--income);
        }

        .recurring-amount.expense {
            color: var(--expense);
        }

        .recurring-item-actions {
            display: flex;
            gap: var(--space-2);
        }

        .btn-icon-small {
            width: 32px;
            height: 32px;
            border: none;
            border-radius: var(--radius-md);
            cursor: pointer;
            transition: all var(--transition-fast);
            display: flex;
            align-items: center;
            justify-content: center;
            background: white;
            color: var(--gray-600);
        }

        .btn-icon-small:hover {
            background: var(--primary);
            color: white;
            transform: scale(1.1);
        }

        .btn-icon-small.delete:hover {
            background: var(--danger);
        }

        .recurring-summary {
            background: linear-gradient(135deg, var(--primary), var(--primary-dark));
            color: white;
            border-radius: var(--radius-xl);
            padding: var(--space-6);
            margin-top: var(--space-6);
        }

        .summary-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: var(--space-4);
        }

        .summary-item {
            text-align: center;
        }

        .summary-item-label {
            font-size: var(--text-sm);
            opacity: 0.9;
            margin-bottom: var(--space-2);
        }

        .summary-item-value {
            font-size: var(--text-2xl);
            font-weight: var(--font-bold);
        }

        .recurring-empty {
            text-align: center;
            padding: var(--space-10);
            color: var(--gray-500);
        }

        .recurring-empty-icon {
            font-size: 4rem;
            margin-bottom: var(--space-4);
            opacity: 0.3;
        }

        /* 모달 스타일 */
        .modal-overlay {
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: rgba(0, 0, 0, 0.5);
            display: none;
            align-items: center;
            justify-content: center;
            z-index: 1000;
        }

        .modal-overlay.active {
            display: flex;
        }

        .modal-content {
            background: white;
            border-radius: var(--radius-xl);
            padding: var(--space-6);
            max-width: 500px;
            width: 90%;
            max-height: 90vh;
            overflow-y: auto;
        }

        .modal-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: var(--space-5);
        }

        .modal-title {
            font-size: var(--text-xl);
            font-weight: var(--font-bold);
            color: var(--gray-800);
        }

        .modal-close {
            background: none;
            border: none;
            font-size: var(--text-2xl);
            cursor: pointer;
            color: var(--gray-500);
            padding: 0;
            width: 32px;
            height: 32px;
            display: flex;
            align-items: center;
            justify-content: center;
            border-radius: var(--radius-md);
        }

        .modal-close:hover {
            background: var(--gray-100);
            color: var(--gray-700);
        }

        .modal-form {
            display: flex;
            flex-direction: column;
            gap: var(--space-4);
        }

        .form-group-modal {
            display: flex;
            flex-direction: column;
            gap: var(--space-2);
        }

        .form-group-modal label {
            font-size: var(--text-sm);
            font-weight: var(--font-semibold);
            color: var(--gray-700);
        }

        .form-group-modal input,
        .form-group-modal select {
            padding: var(--space-3);
            border: 2px solid var(--gray-200);
            border-radius: var(--radius-md);
            font-size: var(--text-base);
            transition: border-color var(--transition-fast);
        }

        .form-group-modal input:focus,
        .form-group-modal select:focus {
            outline: none;
            border-color: var(--primary);
        }

        .btn-submit {
            padding: var(--space-3) var(--space-5);
            background: var(--primary);
            color: white;
            border: none;
            border-radius: var(--radius-lg);
            font-weight: var(--font-semibold);
            cursor: pointer;
            transition: all var(--transition-base);
            margin-top: var(--space-2);
        }

        .btn-submit:hover {
            background: var(--primary-dark);
            transform: translateY(-2px);
            box-shadow: var(--shadow-md);
        }

        /* 반응형 */
        @media (max-width: 768px) {
            .home-container {
                padding: var(--space-4);
            }

            .total-assets-value {
                font-size: var(--text-3xl);
            }

            .metric-value {
                font-size: var(--text-2xl);
            }

            .quick-actions-grid {
                grid-template-columns: repeat(2, 1fr);
            }

            .recurring-container {
                padding: var(--space-4);
            }

            .recurring-header {
                flex-direction: column;
                align-items: stretch;
            }

            .recurring-actions {
                width: 100%;
            }

            .btn-add {
                flex: 1;
            }

            .recurring-item {
                flex-direction: column;
                align-items: stretch;
                gap: var(--space-3);
            }

            .recurring-item-right {
                justify-content: space-between;
            }

            .recurring-amount {
                text-align: left;
            }
        }

        .category-breakdown {
            background: #f8f9fa;
            padding: 25px;
            border-radius: 15px;
            margin-bottom: 30px;
        }

        .category-breakdown h2 {
            color: #667eea;
            margin-bottom: 20px;
            font-size: 1.3em;
        }

        .category-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
            gap: 15px;
        }

        .category-item {
            background: white;
            padding: 15px;
            border-radius: 10px;
            border-left: 4px solid #667eea;
            transition: all 0.3s;
            cursor: pointer;
        }

        .category-item:hover {
            transform: translateY(-2px);
            box-shadow: 0 5px 15px rgba(0,0,0,0.1);
            background: #f8f9fa;
        }

        .category-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 12px;
        }

        .category-preview {
            margin-top: 12px;
            padding-top: 12px;
            border-top: 1px solid #f0f0f0;
        }

        .preview-item {
            font-size: 0.85em;
            color: #666;
            padding: 4px 0;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .preview-item-title {
            flex: 1;
            overflow: hidden;
            text-overflow: ellipsis;
            white-space: nowrap;
            margin-right: 10px;
        }

        .preview-item-amount {
            color: #11998e;
            font-weight: 600;
        }

        .preview-more {
            font-size: 0.8em;
            color: #667eea;
            margin-top: 6px;
            text-align: center;
            font-weight: 600;
        }

        .category-item.kaito {
            border-left-color: #667eea;
        }

        .category-item.telegram {
            border-left-color: #38ef7d;
        }

        .category-item.event {
            border-left-color: #ff6a00;
        }

        .category-item.other {
            border-left-color: #999;
        }

        .category-name {
            font-weight: 600;
            color: #333;
            font-size: 0.95em;
        }

        .category-amount {
            font-size: 1.2em;
            font-weight: bold;
            color: #11998e;
        }

        .category-count {
            font-size: 0.8em;
            color: #999;
            margin-top: 3px;
        }

        .modal {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0,0,0,0.5);
            z-index: 1000;
            justify-content: center;
            align-items: center;
            padding: 20px;
        }

        .modal.active {
            display: flex;
        }

        .modal-content {
            background: white;
            border-radius: 15px;
            padding: 30px;
            max-width: 800px;
            width: 100%;
            max-height: 80vh;
            overflow-y: auto;
            box-shadow: 0 20px 60px rgba(0,0,0,0.3);
        }

        .modal-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 20px;
            padding-bottom: 15px;
            border-bottom: 2px solid #f0f0f0;
        }

        .modal-header h2 {
            color: #667eea;
            font-size: 1.5em;
        }

        .modal-close {
            background: none;
            border: none;
            font-size: 2em;
            color: #999;
            cursor: pointer;
            line-height: 1;
            padding: 0;
            width: 30px;
            height: 30px;
        }

        .modal-close:hover {
            color: #667eea;
        }

        .modal-transaction {
            background: #f8f9fa;
            padding: 15px;
            border-radius: 10px;
            margin-bottom: 10px;
            border-left: 4px solid #38ef7d;
        }

        .modal-transaction-title {
            font-weight: 600;
            color: #333;
            margin-bottom: 5px;
            font-size: 1.1em;
        }

        .modal-transaction-desc {
            color: #666;
            font-size: 0.9em;
            margin-bottom: 8px;
        }

        .modal-transaction-footer {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-top: 10px;
        }

        .modal-transaction-date {
            color: #999;
            font-size: 0.85em;
        }

        .modal-transaction-amount {
            font-size: 1.2em;
            font-weight: bold;
            color: #11998e;
        }

        @media (max-width: 768px) {
            .container {
                padding: 20px;
            }

            .transaction-item {
                flex-direction: column;
                align-items: flex-start;
                gap: 10px;
            }

            .transaction-amount,
            .transaction-date {
                margin-right: 0;
            }

            .modal-content {
                padding: 20px;
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <h1>💰 Web3 수익 가계부</h1>
        <p class="subtitle">에어드랍 및 Web3 활동 수익 관리</p>

        <div class="tab-navigation">
            <button class="tab-button active" onclick="switchTab('home')">🏠 홈</button>
            <button class="tab-button" onclick="switchTab('dashboard')">📊 대시보드</button>
            <button class="tab-button" onclick="switchTab('recurring')">💼 고정 항목</button>
            <button class="tab-button" onclick="switchTab('rpg')">🎮 RPG</button>
            <button class="tab-button" onclick="switchTab('transactions')">📝 거래 내역</button>
        </div>

        <!-- 홈 탭 -->
        <div id="home" class="tab-content active">
            <div class="home-container">
                <div class="home-grid">
                    <!-- 총 자산 카드 -->
                    <div class="total-assets-card">
                        <div class="total-assets-label">💰 총 자산</div>
                        <div class="total-assets-value" id="homePageTotalAssets">0원</div>
                        <div class="total-assets-change">
                            <span class="change-positive" id="homePageAssetChange">↑ 0원 (0%)</span>
                            <span style="opacity: 0.8;">이번 달</span>
                        </div>
                    </div>

                    <!-- 수입/지출/순수익 -->
                    <div class="metrics-grid">
                        <div class="metric-card income">
                            <div class="metric-header">
                                <span class="metric-icon">💚</span>
                                <span class="metric-label">이번 달 수입</span>
                            </div>
                            <div class="metric-value income-color" id="homeMonthIncome">0원</div>
                            <div class="metric-detail" id="homeIncomeCount">0건</div>
                            <div class="metric-action">
                                <a href="#" class="metric-link" onclick="event.preventDefault(); switchTab('dashboard')">상세보기 →</a>
                            </div>
                        </div>

                        <div class="metric-card expense">
                            <div class="metric-header">
                                <span class="metric-icon">💸</span>
                                <span class="metric-label">이번 달 지출</span>
                            </div>
                            <div class="metric-value expense-color" id="homeMonthExpense">0원</div>
                            <div class="metric-detail" id="homeExpenseCount">0건</div>
                            <div class="metric-action">
                                <a href="#" class="metric-link" onclick="event.preventDefault(); switchTab('dashboard')">상세보기 →</a>
                            </div>
                        </div>

                        <div class="metric-card profit">
                            <div class="metric-header">
                                <span class="metric-icon">💰</span>
                                <span class="metric-label">순수익</span>
                            </div>
                            <div class="metric-value profit-color" id="homeMonthProfit">0원</div>
                            <div class="metric-detail">수입 - 지출</div>
                            <div class="metric-action">
                                <a href="#" class="metric-link" onclick="event.preventDefault(); switchTab('rpg')">RPG 보기 →</a>
                            </div>
                        </div>
                    </div>

                    <!-- 자산 분포 -->
                    <div class="asset-distribution-card">
                        <h2 class="card-title">📊 자산 분포</h2>
                        
                        <div class="asset-item">
                            <div class="asset-icon web3">💎</div>
                            <div class="asset-info">
                                <div class="asset-name">Web3 지갑</div>
                                <div class="asset-bar-container">
                                    <div class="asset-bar">
                                        <div class="asset-bar-fill web3" id="web3Bar" style="width: 0%"></div>
                                    </div>
                                    <div class="asset-percent" id="web3Percent">0%</div>
                                </div>
                            </div>
                            <div class="asset-amount" id="web3Amount">0원</div>
                        </div>

                        <div class="asset-item">
                            <div class="asset-icon investment">📈</div>
                            <div class="asset-info">
                                <div class="asset-name">투자 계정</div>
                                <div class="asset-bar-container">
                                    <div class="asset-bar">
                                        <div class="asset-bar-fill investment" id="investmentBar" style="width: 0%"></div>
                                    </div>
                                    <div class="asset-percent" id="investmentPercent">0%</div>
                                </div>
                            </div>
                            <div class="asset-amount" id="investmentAmount">0원</div>
                        </div>

                        <div class="asset-item">
                            <div class="asset-icon bank">🏦</div>
                            <div class="asset-info">
                                <div class="asset-name">은행 계정</div>
                                <div class="asset-bar-container">
                                    <div class="asset-bar">
                                        <div class="asset-bar-fill bank" id="bankBar" style="width: 0%"></div>
                                    </div>
                                    <div class="asset-percent" id="bankPercent">0%</div>
                                </div>
                            </div>
                            <div class="asset-amount" id="bankAmount">0원</div>
                        </div>
                    </div>

                    <!-- 자금 흐름 -->
                    <div class="cashflow-card">
                        <h2 class="card-title">💧 이번 달 자금 흐름</h2>
                        
                        <!-- 수입원 -->
                        <div class="cashflow-section">
                            <div class="cashflow-section-title">
                                📥 주요 수입원
                            </div>
                            <div id="topIncomeList"></div>
                            <div class="cashflow-summary">
                                <span class="summary-label">총 수입</span>
                                <span class="summary-value positive" id="totalIncomeFlow">0원</span>
                            </div>
                        </div>

                        <!-- 지출처 -->
                        <div class="cashflow-section">
                            <div class="cashflow-section-title">
                                📤 주요 지출처
                            </div>
                            <div id="topExpenseList"></div>
                            <div class="cashflow-summary">
                                <span class="summary-label">총 지출</span>
                                <span class="summary-value negative" id="totalExpenseFlow">0원</span>
                            </div>
                        </div>

                        <!-- 인사이트 -->
                        <div class="insights-section">
                            <div class="cashflow-section-title">
                                💡 자동 인사이트
                            </div>
                            <div id="cashflowInsights"></div>
                        </div>
                    </div>

                    <!-- 월별 트렌드 차트 -->
                    <div class="chart-card">
                        <h2 class="card-title">📈 월별 수입/지출 트렌드</h2>
                        <div class="chart-container">
                            <canvas id="monthlyTrendChart"></canvas>
                        </div>
                    </div>

                    <!-- 빠른 액션 -->
                    <div class="quick-actions-card">
                        <h2 class="card-title">🔥 빠른 액션</h2>
                        <div class="quick-actions-grid">
                            <button class="quick-action-btn" onclick="switchTab('dashboard')">
                                <span class="quick-action-icon">➕</span>
                                <span class="quick-action-label">수입 추가</span>
                            </button>
                            <button class="quick-action-btn" onclick="switchTab('dashboard')">
                                <span class="quick-action-icon">➖</span>
                                <span class="quick-action-label">지출 추가</span>
                            </button>
                            <button class="quick-action-btn" onclick="switchTab('rpg')">
                                <span class="quick-action-icon">🏦</span>
                                <span class="quick-action-label">대출 상환</span>
                            </button>
                            <button class="quick-action-btn" onclick="switchTab('transactions')">
                                <span class="quick-action-icon">📊</span>
                                <span class="quick-action-label">거래 내역</span>
                            </button>
                            <button class="quick-action-btn" onclick="exportToCSV()">
                                <span class="quick-action-icon">📥</span>
                                <span class="quick-action-label">CSV 내보내기</span>
                            </button>
                            <button class="quick-action-btn" onclick="switchTab('rpg')">
                                <span class="quick-action-icon">🎮</span>
                                <span class="quick-action-label">RPG 모드</span>
                            </button>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- 대시보드 탭 -->
        <div id="dashboard" class="tab-content">
            <div class="date-filter">
                <label>기간:</label>
                <button class="date-filter-btn active" onclick="setDateFilter('all')">전체</button>
                <button class="date-filter-btn" onclick="setDateFilter('week')">이번 주</button>
                <button class="date-filter-btn" onclick="setDateFilter('month')">이번 달</button>
                <button class="date-filter-btn" onclick="setDateFilter('lastMonth')">지난 달</button>
            </div>

            <div class="summary">
                <div class="summary-card income">
                    <h3>총 수입</h3>
                    <div class="amount" id="totalIncome">$0</div>
                </div>
                <div class="summary-card expense">
                    <h3>총 지출</h3>
                    <div class="amount" id="totalExpense">$0</div>
                </div>
                <div class="summary-card">
                    <h3>순수익</h3>
                    <div class="amount" id="netProfit">$0</div>
                </div>
            </div>

            <div class="stats-grid">
                <div class="stat-card">
                    <h4>📊 총 거래 건수</h4>
                    <div class="stat-value" id="totalTransactions">0</div>
                </div>
                <div class="stat-card">
                    <h4>💰 평균 수입</h4>
                    <div class="stat-value" id="avgIncome">$0</div>
                </div>
                <div class="stat-card">
                    <h4>🎯 최고 수익 카테고리</h4>
                    <div class="stat-value" id="topCategory" style="font-size:1.1em;">-</div>
                </div>
                <div class="stat-card">
                    <h4>📅 최근 거래일</h4>
                    <div class="stat-value" id="lastTransactionDate" style="font-size:1em;">-</div>
                </div>
            </div>

            <div class="input-section">
                <div class="edit-mode-banner" id="editModeBanner">
                    ✏️ 수정 모드 - 거래를 수정하고 있습니다
                    <button class="btn btn-secondary" style="margin-left:15px;" onclick="cancelEdit()">취소</button>
                </div>
                
                <h2>거래 추가</h2>
                <div class="form-group">
                    <div>
                        <label>유형</label>
                        <select id="type" onchange="updateDynamicFields()">
                            <option value="income">수입</option>
                            <option value="expense">지출</option>
                        </select>
                    </div>
                    <div>
                        <label>카테고리</label>
                        <select id="category" onchange="updateDynamicFields()">
                            <optgroup label="수입">
                                <option value="Kaito yapping">Kaito yapping</option>
                                <option value="텔레그램 야핑">텔레그램 야핑</option>
                                <option value="이벤트 참여">이벤트 참여</option>
                                <option value="에어드랍">에어드랍</option>
                                <option value="테스트넷">테스트넷</option>
                                <option value="스테이킹">스테이킹</option>
                                <option value="NFT 판매">NFT 판매</option>
                                <option value="기타 수입">기타 수입</option>
                            </optgroup>
                            <optgroup label="지출">
                                <option value="가스비">가스비</option>
                                <option value="NFT 구매">NFT 구매</option>
                                <option value="토큰 구매">토큰 구매</option>
                                <option value="브릿지">브릿지</option>
                                <option value="거래 수수료">거래 수수료</option>
                                <option value="기타 지출">기타 지출</option>
                            </optgroup>
                        </select>
                    </div>
                    <div>
                        <label>날짜</label>
                        <input type="date" id="date">
                    </div>
                </div>

                <!-- 동적 필드 영역 -->
                <div id="dynamicFieldsContainer"></div>

                <div class="form-group">
                    <div style="grid-column: 1 / -1;">
                        <label>제목 (핵심 타이틀)</label>
                        <input type="text" id="title" placeholder="예: Arbitrum 에어드랍">
                    </div>
                </div>
                <div class="form-group">
                    <div style="grid-column: 1 / -1;">
                        <label>상세 설명</label>
                        <input type="text" id="description" placeholder="상세한 내용을 입력하세요 (선택사항)">
                    </div>
                </div>
                <button class="btn" onclick="addTransaction()">거래 추가</button>
            </div>

            <div class="category-breakdown">
                <h2>📊 카테고리별 수입 분석</h2>
                <div class="category-grid" id="categoryBreakdown"></div>
            </div>

            <!-- 차트 섹션 -->
            <div class="charts-grid">
                <div class="chart-card">
                    <h2 class="card-title">📊 수입 카테고리 분포</h2>
                    <div class="chart-container small">
                        <canvas id="incomePieChart"></canvas>
                    </div>
                </div>

                <div class="chart-card">
                    <h2 class="card-title">💸 지출 카테고리 분포</h2>
                    <div class="chart-container small">
                        <canvas id="expensePieChart"></canvas>
                    </div>
                </div>
            </div>
        </div>

        <!-- 고정 항목 탭 -->
        <div id="recurring" class="tab-content">
            <div class="recurring-container">
                <div class="recurring-header">
                    <h1 style="font-size: var(--text-3xl); font-weight: var(--font-bold); color: var(--gray-800);">
                        💼 고정 항목 관리
                    </h1>
                    <div class="recurring-actions">
                        <button class="btn-add income" onclick="openRecurringModal('income')">
                            ➕ 고정 수입 추가
                        </button>
                        <button class="btn-add expense" onclick="openRecurringModal('expense')">
                            ➕ 고정 지출 추가
                        </button>
                    </div>
                </div>

                <!-- 고정 수입 -->
                <div class="recurring-section">
                    <div class="recurring-section-header">
                        <div class="recurring-section-title">
                            📥 고정 수입
                        </div>
                        <div class="recurring-total income" id="totalRecurringIncome">월 0원</div>
                    </div>
                    <div id="recurringIncomeList"></div>
                </div>

                <!-- 고정 지출 -->
                <div class="recurring-section">
                    <div class="recurring-section-header">
                        <div class="recurring-section-title">
                            📤 고정 지출
                        </div>
                        <div class="recurring-total expense" id="totalRecurringExpense">월 0원</div>
                    </div>
                    <div id="recurringExpenseList"></div>
                </div>

                <!-- 요약 -->
                <div class="recurring-summary">
                    <div class="summary-grid">
                        <div class="summary-item">
                            <div class="summary-item-label">총 고정 수입</div>
                            <div class="summary-item-value" id="summaryIncome">월 0원</div>
                        </div>
                        <div class="summary-item">
                            <div class="summary-item-label">총 고정 지출</div>
                            <div class="summary-item-value" id="summaryExpense">월 0원</div>
                        </div>
                        <div class="summary-item">
                            <div class="summary-item-label">예상 월 순수익</div>
                            <div class="summary-item-value" id="summaryProfit">+0원</div>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- 고정 항목 추가/수정 모달 -->
        <div class="modal-overlay" id="recurringModal" onclick="closeModalOnOverlay(event)">
            <div class="modal-content" onclick="event.stopPropagation()">
                <div class="modal-header">
                    <h2 class="modal-title" id="recurringModalTitle">고정 항목 추가</h2>
                    <button class="modal-close" onclick="closeRecurringModal()">×</button>
                </div>
                <form class="modal-form" onsubmit="saveRecurringItem(event)">
                    <input type="hidden" id="recurringEditId">
                    <input type="hidden" id="recurringType">

                    <div class="form-group-modal">
                        <label for="recurringCategory">카테고리 *</label>
                        <input type="text" id="recurringCategory" required placeholder="예: 본업 급여, 대출 상환">
                    </div>

                    <div class="form-group-modal">
                        <label for="recurringAmount">금액 (원) *</label>
                        <input type="number" id="recurringAmount" required placeholder="0" step="1000">
                    </div>

                    <div class="form-group-modal">
                        <label for="recurringFrequency">반복 주기 *</label>
                        <select id="recurringFrequency" required>
                            <option value="monthly">매월</option>
                            <option value="weekly">매주</option>
                            <option value="daily">매일</option>
                        </select>
                    </div>

                    <div class="form-group-modal">
                        <label for="recurringDay">반복일 *</label>
                        <input type="number" id="recurringDay" required placeholder="1-31" min="1" max="31">
                        <small style="color: var(--gray-500);">매월 X일 (예: 5일, 25일)</small>
                    </div>

                    <div class="form-group-modal">
                        <label for="recurringDescription">설명</label>
                        <input type="text" id="recurringDescription" placeholder="추가 설명 (선택사항)">
                    </div>

                    <button type="submit" class="btn-submit">저장</button>
                </form>
            </div>
        </div>

        <!-- RPG 탭 -->
        <div id="rpg" class="tab-content">
            <div class="rpg-container">
                <!-- Main Quest -->
                <div class="main-quest">
                    <h2>🎯 Main Quest: 500억 자산 달성</h2>
                    <div class="main-quest-progress">
                        <div class="main-quest-fill" id="mainQuestProgress" style="width: 0.1%">
                            0.1%
                        </div>
                    </div>
                    <div class="main-quest-stats">
                        <span>현재: <span id="currentAssets">5,000만원</span></span>
                        <span>목표: 500억원</span>
                    </div>
                </div>

                <!-- 선물 중독 보스 -->
                <div class="boss-card futures">
                    <div class="boss-header">
                        <div class="boss-title danger">🔥 선물 중독 보스</div>
                    </div>
                    
                    <div class="streak-display">
                        <div class="streak-number" id="streakNumber">0</div>
                        <div class="streak-label">연속 중단 일수</div>
                        <div class="max-streak">
                            🏆 최장 기록: <span id="maxStreak">0</span>일
                        </div>
                    </div>

                    <button class="reset-button" onclick="resetFuturesStreak()">
                        ⚠️ 리셋 (선물 매매 시)
                    </button>
                </div>

                <!-- 은행 대출 보스 -->
                <div class="boss-card debt">
                    <div class="boss-header">
                        <div class="boss-title">🏦 은행 대출 보스</div>
                    </div>
                    
                    <div class="hp-bar-container">
                        <div class="hp-bar-label">
                            <span>현재 HP (잔액)</span>
                            <span id="bankLoanRemaining">4.1억원</span>
                        </div>
                        <div class="hp-bar">
                            <div class="hp-bar-fill" id="bankLoanBar" style="width: 100%">
                                100%
                            </div>
                        </div>
                    </div>

                    <div class="debt-info">
                        <div class="debt-stat">
                            <div class="debt-stat-label">총 대출금</div>
                            <div class="debt-stat-value">4.1억원</div>
                        </div>
                        <div class="debt-stat">
                            <div class="debt-stat-label">월 데미지</div>
                            <div class="debt-stat-value" style="color: #dc3545;">-210만원</div>
                        </div>
                        <div class="debt-stat">
                            <div class="debt-stat-label">상환 완료</div>
                            <div class="debt-stat-value" id="bankLoanPaid">0원</div>
                        </div>
                    </div>
                </div>

                <!-- 부모님 대출 보스 -->
                <div class="boss-card debt">
                    <div class="boss-header">
                        <div class="boss-title">👨‍👩‍👧 부모님 대출 보스</div>
                    </div>
                    
                    <div class="hp-bar-container">
                        <div class="hp-bar-label">
                            <span>현재 HP (잔액)</span>
                            <span id="parentLoanRemaining">1.5억원</span>
                        </div>
                        <div class="hp-bar">
                            <div class="hp-bar-fill" id="parentLoanBar" style="width: 100%">
                                100%
                            </div>
                        </div>
                    </div>

                    <div class="debt-info">
                        <div class="debt-stat">
                            <div class="debt-stat-label">총 대출금</div>
                            <div class="debt-stat-value">1.5억원</div>
                        </div>
                        <div class="debt-stat">
                            <div class="debt-stat-label">월 데미지</div>
                            <div class="debt-stat-value" style="color: #dc3545;">-80만원</div>
                        </div>
                        <div class="debt-stat">
                            <div class="debt-stat-label">상환 완료</div>
                            <div class="debt-stat-value" id="parentLoanPaid">0원</div>
                        </div>
                    </div>
                </div>

                <!-- Daily Quest -->
                <div class="daily-quests">
                    <h2>📝 Daily Quest</h2>
                    <div class="quest-item" onclick="toggleQuest('noFutures')" id="quest-noFutures">
                        <div class="quest-checkbox"></div>
                        <div class="quest-text">선물 매매 0회 유지</div>
                    </div>
                    <div class="quest-item" onclick="toggleQuest('vibeCoding')" id="quest-vibeCoding">
                        <div class="quest-checkbox"></div>
                        <div class="quest-text">바이브 코딩 1.5시간</div>
                    </div>
                    <div class="quest-item" onclick="toggleQuest('xPosting')" id="quest-xPosting">
                        <div class="quest-checkbox"></div>
                        <div class="quest-text">X 포스팅 1회</div>
                    </div>
                    <div class="quest-item" onclick="toggleQuest('mentalCheck')" id="quest-mentalCheck">
                        <div class="quest-checkbox"></div>
                        <div class="quest-text">멘탈 체크 완료</div>
                    </div>
                </div>
            </div>
        </div>

        <!-- 거래 내역 탭 -->
        <div id="transactions" class="tab-content">
            <div class="transactions">
                <h2>거래 내역</h2>
                
                <div class="action-buttons">
                    <button class="btn btn-secondary" onclick="exportToCSV()">📥 CSV로 내보내기</button>
                    <button class="btn btn-secondary" onclick="clearAllData()">🗑️ 전체 데이터 삭제</button>
                </div>

                <div class="filter-section">
                    <label>필터:</label>
                    <select id="filterType" onchange="filterTransactions()">
                        <option value="all">전체</option>
                        <option value="income">수입만</option>
                        <option value="expense">지출만</option>
                    </select>
                    <select id="filterCategory" onchange="filterTransactions()">
                        <option value="all">모든 카테고리</option>
                    </select>
                    <input type="text" id="searchInput" placeholder="🔍 제목 또는 설명 검색..." 
                           style="padding:8px;border:2px solid #ddd;border-radius:8px;min-width:200px;"
                           oninput="filterTransactions()">
                </div>
                <div class="transaction-list" id="transactionList"></div>
            </div>
        </div>

        <!-- 카테고리 상세 모달 -->
        <div class="modal" id="categoryModal">
            <div class="modal-content">
                <div class="modal-header">
                    <h2 id="modalTitle"></h2>
                    <button class="modal-close" onclick="closeModal()">&times;</button>
                </div>
                <div id="modalBody"></div>
            </div>
        </div>
    </div>

    <script>
        let transactions = JSON.parse(localStorage.getItem('web3Transactions')) || [];
        let currentDateFilter = 'all';
        let editingTransactionId = null; // 수정 중인 거래 ID

        // RPG 데이터
        let rpgData = JSON.parse(localStorage.getItem('web3_rpg_data')) || {
            futuresAbstinence: {
                currentStreak: 0,
                maxStreak: 0,
                lastCheckDate: new Date().toISOString().split('T')[0]
            },
            debts: {
                bankLoan: { total: 410000000, paid: 0, monthly: 2100000 },
                parentLoan: { total: 150000000, paid: 0, monthly: 800000 }
            },
            dailyQuests: {
                date: new Date().toISOString().split('T')[0],
                completed: {
                    noFutures: true,
                    vibeCoding: false,
                    xPosting: false,
                    mentalCheck: false
                }
            },
            stats: {
                level: 1,
                familyPower: 0,
                mentalDefense: 0,
                techPower: 0
            }
        };

        // 고정 항목 데이터
        let recurringItems = JSON.parse(localStorage.getItem('web3_recurring_items')) || [];

        // 오늘 날짜를 기본값으로 설정
        document.getElementById('date').valueAsDate = new Date();

        // RPG 데이터 저장
        function saveRPGData() {
            localStorage.setItem('web3_rpg_data', JSON.stringify(rpgData));
        }

        // 매일 자동 업데이트 체크
        function checkDailyUpdate() {
            const today = new Date().toISOString().split('T')[0];
            const lastCheck = rpgData.futuresAbstinence.lastCheckDate;
            
            if (today !== lastCheck) {
                // 날짜 바뀜 → 연속 일수 +1
                rpgData.futuresAbstinence.currentStreak++;
                rpgData.futuresAbstinence.lastCheckDate = today;
                
                // 최장 기록 갱신
                if (rpgData.futuresAbstinence.currentStreak > rpgData.futuresAbstinence.maxStreak) {
                    rpgData.futuresAbstinence.maxStreak = rpgData.futuresAbstinence.currentStreak;
                }
                
                // Daily Quest 리셋
                rpgData.dailyQuests.date = today;
                rpgData.dailyQuests.completed = {
                    noFutures: true, // 기본적으로 선물 안 함
                    vibeCoding: false,
                    xPosting: false,
                    mentalCheck: false
                };
                
                saveRPGData();
                updateRPGDisplay();
            }
        }

        // 선물 중독 리셋
        function resetFuturesStreak() {
            const currentStreak = rpgData.futuresAbstinence.currentStreak;
            
            if (currentStreak === 0) {
                alert('이미 0일입니다.');
                return;
            }
            
            const confirmed = confirm(`⚠️ 경고!\n\n${currentStreak}일간의 기록이 사라집니다.\n정말로 리셋하시겠습니까?`);
            
            if (confirmed) {
                rpgData.futuresAbstinence.currentStreak = 0;
                rpgData.dailyQuests.completed.noFutures = false;
                saveRPGData();
                updateRPGDisplay();
                alert('리셋되었습니다. 다시 시작하세요!');
            }
        }

        // Daily Quest 토글
        function toggleQuest(questName) {
            rpgData.dailyQuests.completed[questName] = !rpgData.dailyQuests.completed[questName];
            saveRPGData();
            updateRPGDisplay();
        }

        // RPG 화면 업데이트
        function updateRPGDisplay() {
            // 선물 중독 보스
            document.getElementById('streakNumber').textContent = rpgData.futuresAbstinence.currentStreak;
            document.getElementById('maxStreak').textContent = rpgData.futuresAbstinence.maxStreak;
            
            // 은행 대출
            const bankRemaining = rpgData.debts.bankLoan.total - rpgData.debts.bankLoan.paid;
            const bankPercent = ((bankRemaining / rpgData.debts.bankLoan.total) * 100).toFixed(1);
            document.getElementById('bankLoanRemaining').textContent = 
                `${(bankRemaining / 100000000).toFixed(1)}억원`;
            document.getElementById('bankLoanBar').style.width = bankPercent + '%';
            document.getElementById('bankLoanBar').textContent = bankPercent + '%';
            document.getElementById('bankLoanPaid').textContent = 
                `${(rpgData.debts.bankLoan.paid / 10000).toFixed(0)}만원`;
            
            // HP 바 색상 변경
            const bankBar = document.getElementById('bankLoanBar');
            if (bankPercent > 66) {
                bankBar.className = 'hp-bar-fill';
            } else if (bankPercent > 33) {
                bankBar.className = 'hp-bar-fill medium';
            } else {
                bankBar.className = 'hp-bar-fill good';
            }
            
            // 부모님 대출
            const parentRemaining = rpgData.debts.parentLoan.total - rpgData.debts.parentLoan.paid;
            const parentPercent = ((parentRemaining / rpgData.debts.parentLoan.total) * 100).toFixed(1);
            document.getElementById('parentLoanRemaining').textContent = 
                `${(parentRemaining / 100000000).toFixed(1)}억원`;
            document.getElementById('parentLoanBar').style.width = parentPercent + '%';
            document.getElementById('parentLoanBar').textContent = parentPercent + '%';
            document.getElementById('parentLoanPaid').textContent = 
                `${(rpgData.debts.parentLoan.paid / 10000).toFixed(0)}만원`;
            
            const parentBar = document.getElementById('parentLoanBar');
            if (parentPercent > 66) {
                parentBar.className = 'hp-bar-fill';
            } else if (parentPercent > 33) {
                parentBar.className = 'hp-bar-fill medium';
            } else {
                parentBar.className = 'hp-bar-fill good';
            }
            
            // Daily Quest 체크 상태
            Object.keys(rpgData.dailyQuests.completed).forEach(questName => {
                const element = document.getElementById(`quest-${questName}`);
                if (element) {
                    if (rpgData.dailyQuests.completed[questName]) {
                        element.classList.add('completed');
                    } else {
                        element.classList.remove('completed');
                    }
                }
            });
        }

        // 페이지 로드 시 RPG 데이터 체크
        window.addEventListener('DOMContentLoaded', function() {
            checkDailyUpdate();
            updateRPGDisplay();
            updateHomePageData();
            initCharts();
            displayRecurringItems();
        });

        // 차트 인스턴스 저장
        let monthlyTrendChart = null;
        let incomePieChart = null;
        let expensePieChart = null;

        // 차트 초기화
        function initCharts() {
            // 월별 트렌드 차트
            const trendCtx = document.getElementById('monthlyTrendChart');
            if (trendCtx) {
                monthlyTrendChart = new Chart(trendCtx, {
                    type: 'line',
                    data: {
                        labels: [],
                        datasets: [{
                            label: '수입',
                            data: [],
                            borderColor: 'rgb(72, 187, 120)',
                            backgroundColor: 'rgba(72, 187, 120, 0.1)',
                            tension: 0.4,
                            fill: true
                        }, {
                            label: '지출',
                            data: [],
                            borderColor: 'rgb(245, 101, 101)',
                            backgroundColor: 'rgba(245, 101, 101, 0.1)',
                            tension: 0.4,
                            fill: true
                        }]
                    },
                    options: {
                        responsive: true,
                        maintainAspectRatio: false,
                        plugins: {
                            legend: {
                                display: true,
                                position: 'top'
                            },
                            tooltip: {
                                callbacks: {
                                    label: function(context) {
                                        return context.dataset.label + ': ' + formatCurrency(context.parsed.y);
                                    }
                                }
                            }
                        },
                        scales: {
                            y: {
                                beginAtZero: true,
                                ticks: {
                                    callback: function(value) {
                                        return formatCurrency(value);
                                    }
                                }
                            }
                        }
                    }
                });
            }

            // 수입 파이 차트
            const incomeCtx = document.getElementById('incomePieChart');
            if (incomeCtx) {
                incomePieChart = new Chart(incomeCtx, {
                    type: 'doughnut',
                    data: {
                        labels: [],
                        datasets: [{
                            data: [],
                            backgroundColor: [
                                'rgba(102, 126, 234, 0.8)',
                                'rgba(72, 187, 120, 0.8)',
                                'rgba(66, 153, 225, 0.8)',
                                'rgba(237, 137, 54, 0.8)',
                                'rgba(159, 122, 234, 0.8)',
                                'rgba(236, 201, 75, 0.8)'
                            ],
                            borderWidth: 2,
                            borderColor: '#fff'
                        }]
                    },
                    options: {
                        responsive: true,
                        maintainAspectRatio: false,
                        plugins: {
                            legend: {
                                display: true,
                                position: 'bottom'
                            },
                            tooltip: {
                                callbacks: {
                                    label: function(context) {
                                        const label = context.label || '';
                                        const value = formatCurrency(context.parsed);
                                        const total = context.dataset.data.reduce((a, b) => a + b, 0);
                                        const percent = ((context.parsed / total) * 100).toFixed(1);
                                        return label + ': ' + value + ' (' + percent + '%)';
                                    }
                                }
                            }
                        }
                    }
                });
            }

            // 지출 파이 차트
            const expenseCtx = document.getElementById('expensePieChart');
            if (expenseCtx) {
                expensePieChart = new Chart(expenseCtx, {
                    type: 'doughnut',
                    data: {
                        labels: [],
                        datasets: [{
                            data: [],
                            backgroundColor: [
                                'rgba(245, 101, 101, 0.8)',
                                'rgba(237, 137, 54, 0.8)',
                                'rgba(255, 193, 7, 0.8)',
                                'rgba(233, 30, 99, 0.8)',
                                'rgba(156, 39, 176, 0.8)',
                                'rgba(103, 58, 183, 0.8)'
                            ],
                            borderWidth: 2,
                            borderColor: '#fff'
                        }]
                    },
                    options: {
                        responsive: true,
                        maintainAspectRatio: false,
                        plugins: {
                            legend: {
                                display: true,
                                position: 'bottom'
                            },
                            tooltip: {
                                callbacks: {
                                    label: function(context) {
                                        const label = context.label || '';
                                        const value = formatCurrency(context.parsed);
                                        const total = context.dataset.data.reduce((a, b) => a + b, 0);
                                        const percent = ((context.parsed / total) * 100).toFixed(1);
                                        return label + ': ' + value + ' (' + percent + '%)';
                                    }
                                }
                            }
                        }
                    }
                });
            }

            // 초기 데이터 로드
            updateCharts();
        }

        // 차트 업데이트
        function updateCharts() {
            updateMonthlyTrendChart();
            updateCategoryCharts();
        }

        // 월별 트렌드 차트 업데이트
        function updateMonthlyTrendChart() {
            if (!monthlyTrendChart) return;

            // 최근 6개월 데이터
            const months = [];
            const incomeData = [];
            const expenseData = [];

            for (let i = 5; i >= 0; i--) {
                const date = new Date();
                date.setMonth(date.getMonth() - i);
                const year = date.getFullYear();
                const month = date.getMonth();

                // 해당 월의 거래 필터링
                const monthTransactions = transactions.filter(t => {
                    const tDate = new Date(t.date);
                    return tDate.getFullYear() === year && tDate.getMonth() === month;
                });

                // 수입/지출 합계
                const income = monthTransactions
                    .filter(t => t.type === 'income')
                    .reduce((sum, t) => sum + t.amount, 0);
                
                const expense = monthTransactions
                    .filter(t => t.type === 'expense')
                    .reduce((sum, t) => sum + t.amount, 0);

                months.push(`${month + 1}월`);
                incomeData.push(income);
                expenseData.push(expense);
            }

            monthlyTrendChart.data.labels = months;
            monthlyTrendChart.data.datasets[0].data = incomeData;
            monthlyTrendChart.data.datasets[1].data = expenseData;
            monthlyTrendChart.update();
        }

        // 카테고리 차트 업데이트
        function updateCategoryCharts() {
            if (!incomePieChart || !expensePieChart) return;

            // 현재 날짜 필터에 따른 거래
            const filtered = getFilteredTransactionsByDate();

            // 수입 카테고리별 집계
            const incomeByCategory = {};
            filtered.filter(t => t.type === 'income').forEach(t => {
                incomeByCategory[t.category] = (incomeByCategory[t.category] || 0) + t.amount;
            });

            // 지출 카테고리별 집계
            const expenseByCategory = {};
            filtered.filter(t => t.type === 'expense').forEach(t => {
                expenseByCategory[t.category] = (expenseByCategory[t.category] || 0) + t.amount;
            });

            // 수입 차트 업데이트
            const incomeLabels = Object.keys(incomeByCategory);
            const incomeValues = Object.values(incomeByCategory);
            
            if (incomeLabels.length > 0) {
                incomePieChart.data.labels = incomeLabels;
                incomePieChart.data.datasets[0].data = incomeValues;
                incomePieChart.update();
            }

            // 지출 차트 업데이트
            const expenseLabels = Object.keys(expenseByCategory);
            const expenseValues = Object.values(expenseByCategory);
            
            if (expenseLabels.length > 0) {
                expensePieChart.data.labels = expenseLabels;
                expensePieChart.data.datasets[0].data = expenseValues;
                expensePieChart.update();
            }
        }

        // 홈 페이지 데이터 업데이트
        function updateHomePageData() {
            // 이번 달 시작일
            const now = new Date();
            const startOfMonth = new Date(now.getFullYear(), now.getMonth(), 1);
            
            // 이번 달 거래 필터링
            const thisMonthTransactions = transactions.filter(t => {
                const transDate = new Date(t.date);
                return transDate >= startOfMonth;
            });

            // 수입/지출 계산
            const monthIncome = thisMonthTransactions
                .filter(t => t.type === 'income')
                .reduce((sum, t) => sum + t.amount, 0);
            
            const monthExpense = thisMonthTransactions
                .filter(t => t.type === 'expense')
                .reduce((sum, t) => sum + t.amount, 0);
            
            const monthProfit = monthIncome - monthExpense;

            // 전체 자산 (임시로 순수익의 누적으로 계산)
            const totalAssets = transactions
                .filter(t => t.type === 'income')
                .reduce((sum, t) => sum + t.amount, 0) - 
                transactions
                .filter(t => t.type === 'expense')
                .reduce((sum, t) => sum + t.amount, 0);

            // 홈 페이지 업데이트
            document.getElementById('homePageTotalAssets').textContent = formatCurrency(totalAssets);
            
            // 이번 달 변화 (임시로 이번 달 순수익으로 표시)
            const changePercent = totalAssets > 0 ? ((monthProfit / totalAssets) * 100).toFixed(1) : 0;
            const changeElement = document.getElementById('homePageAssetChange');
            if (monthProfit >= 0) {
                changeElement.className = 'change-positive';
                changeElement.textContent = `↑ ${formatCurrency(monthProfit)} (+${changePercent}%)`;
            } else {
                changeElement.className = 'change-negative';
                changeElement.textContent = `↓ ${formatCurrency(Math.abs(monthProfit))} (${changePercent}%)`;
            }

            // 수입/지출/순수익
            document.getElementById('homeMonthIncome').textContent = formatCurrency(monthIncome);
            document.getElementById('homeMonthExpense').textContent = formatCurrency(monthExpense);
            document.getElementById('homeMonthProfit').textContent = formatCurrency(monthProfit);

            // 거래 건수
            const incomeCount = thisMonthTransactions.filter(t => t.type === 'income').length;
            const expenseCount = thisMonthTransactions.filter(t => t.type === 'expense').length;
            document.getElementById('homeIncomeCount').textContent = `${incomeCount}건`;
            document.getElementById('homeExpenseCount').textContent = `${expenseCount}건`;

            // 자산 분포 (임시 데이터 - 나중에 실제 계정 시스템으로 대체)
            updateAssetDistribution(totalAssets);
            
            // 자금 흐름 분석
            updateCashflowAnalysis(thisMonthTransactions);
        }

        // 자금 흐름 분석
        function updateCashflowAnalysis(thisMonthTransactions) {
            // 카테고리별 수입 집계
            const incomeByCategory = {};
            const expenseByCategory = {};
            
            thisMonthTransactions.forEach(t => {
                if (t.type === 'income') {
                    incomeByCategory[t.category] = (incomeByCategory[t.category] || 0) + t.amount;
                } else if (t.type === 'expense') {
                    expenseByCategory[t.category] = (expenseByCategory[t.category] || 0) + t.amount;
                }
            });

            // 수입/지출 총액
            const totalIncome = Object.values(incomeByCategory).reduce((sum, val) => sum + val, 0);
            const totalExpense = Object.values(expenseByCategory).reduce((sum, val) => sum + val, 0);

            // Top 5로 정렬
            const topIncome = Object.entries(incomeByCategory)
                .sort((a, b) => b[1] - a[1])
                .slice(0, 5);
            
            const topExpense = Object.entries(expenseByCategory)
                .sort((a, b) => b[1] - a[1])
                .slice(0, 5);

            // 수입원 표시
            renderCashflowList('topIncomeList', topIncome, totalIncome, 'income');
            document.getElementById('totalIncomeFlow').textContent = formatCurrency(totalIncome);

            // 지출처 표시
            renderCashflowList('topExpenseList', topExpense, totalExpense, 'expense');
            document.getElementById('totalExpenseFlow').textContent = formatCurrency(totalExpense);

            // 인사이트 생성
            generateInsights(topIncome, topExpense, totalIncome, totalExpense, incomeByCategory, expenseByCategory);
        }

        // 자금 흐름 리스트 렌더링
        function renderCashflowList(elementId, items, total, type) {
            const container = document.getElementById(elementId);
            
            if (items.length === 0) {
                container.innerHTML = '<div style="text-align:center;color:var(--gray-500);padding:var(--space-4);">데이터가 없습니다</div>';
                return;
            }

            const html = items.map(([category, amount], index) => {
                const percent = total > 0 ? ((amount / total) * 100).toFixed(1) : 0;
                const rankClass = index === 0 ? 'top1' : index === 1 ? 'top2' : index === 2 ? 'top3' : '';
                
                return `
                    <div>
                        <div class="cashflow-item">
                            <div class="cashflow-item-left">
                                <div class="cashflow-rank ${rankClass}">${index + 1}</div>
                                <div class="cashflow-name">${category}</div>
                            </div>
                            <div>
                                <span class="cashflow-amount ${type}">${formatCurrency(amount)}</span>
                                <span class="cashflow-percent">${percent}%</span>
                            </div>
                        </div>
                        <div class="cashflow-bar-container">
                            <div class="cashflow-bar ${type}" style="width: ${percent}%"></div>
                        </div>
                    </div>
                `;
            }).join('');

            container.innerHTML = html;
        }

        // 인사이트 생성
        function generateInsights(topIncome, topExpense, totalIncome, totalExpense, incomeByCategory, expenseByCategory) {
            const insights = [];
            const netProfit = totalIncome - totalExpense;
            
            // 1. 최대 수입원
            if (topIncome.length > 0) {
                const [topIncomeCategory, topIncomeAmount] = topIncome[0];
                const percent = ((topIncomeAmount / totalIncome) * 100).toFixed(1);
                insights.push({
                    icon: '💰',
                    text: `<span class="insight-highlight">${topIncomeCategory}</span>이(가) 전체 수입의 <span class="insight-highlight">${percent}%</span>를 차지합니다`,
                    type: 'info'
                });
            }

            // 2. 최대 지출처
            if (topExpense.length > 0) {
                const [topExpenseCategory, topExpenseAmount] = topExpense[0];
                const percent = ((topExpenseAmount / totalExpense) * 100).toFixed(1);
                
                if (percent > 40) {
                    insights.push({
                        icon: '⚠️',
                        text: `<span class="insight-warning">${topExpenseCategory}</span>에서 지출의 <span class="insight-warning">${percent}%</span>를 사용중입니다. 10% 절약 시 <span class="insight-highlight">${formatCurrency(topExpenseAmount * 0.1)}</span> 절감 가능`,
                        type: 'warning'
                    });
                } else {
                    insights.push({
                        icon: '📊',
                        text: `최대 지출은 <span class="insight-highlight">${topExpenseCategory}</span>로 ${formatCurrency(topExpenseAmount)} (${percent}%)입니다`,
                        type: 'info'
                    });
                }
            }

            // 3. Web3 의존도
            const web3Categories = ['Kaito yapping', '텔레그램 야핑', '에어드랍', '테스트넷'];
            const web3Income = Object.entries(incomeByCategory)
                .filter(([cat]) => web3Categories.includes(cat))
                .reduce((sum, [, amount]) => sum + amount, 0);
            
            if (totalIncome > 0) {
                const web3Dependency = ((web3Income / totalIncome) * 100).toFixed(1);
                
                if (web3Dependency > 70) {
                    insights.push({
                        icon: '🎲',
                        text: `Web3 수입 의존도가 <span class="insight-danger">${web3Dependency}%</span>로 높습니다. 수입원 다각화를 권장합니다`,
                        type: 'warning'
                    });
                } else if (web3Dependency > 50) {
                    insights.push({
                        icon: '💎',
                        text: `Web3 수입이 <span class="insight-highlight">${web3Dependency}%</span>를 차지합니다. 적절한 분산 상태입니다`,
                        type: 'success'
                    });
                }
            }

            // 4. 저축률
            if (totalIncome > 0) {
                const savingsRate = ((netProfit / totalIncome) * 100).toFixed(1);
                
                if (savingsRate < 10) {
                    insights.push({
                        icon: '💸',
                        text: `저축률이 <span class="insight-danger">${savingsRate}%</span>로 낮습니다. 지출을 ${formatCurrency(totalIncome * 0.15 - netProfit)} 줄이면 15% 목표 달성 가능`,
                        type: 'danger'
                    });
                } else if (savingsRate >= 15) {
                    insights.push({
                        icon: '✅',
                        text: `저축률 <span class="insight-highlight">${savingsRate}%</span>로 훌륭합니다! 이번 달 <span class="insight-highlight">${formatCurrency(netProfit)}</span> 절약 중`,
                        type: 'success'
                    });
                } else {
                    insights.push({
                        icon: '💪',
                        text: `저축률 ${savingsRate}%로 양호합니다. 15% 목표까지 ${formatCurrency(totalIncome * 0.15 - netProfit)} 남았습니다`,
                        type: 'info'
                    });
                }
            }

            // 5. 절약 제안
            if (topExpense.length >= 2) {
                const [, secondExpenseAmount] = topExpense[1];
                if (secondExpenseAmount > totalIncome * 0.15) {
                    insights.push({
                        icon: '💡',
                        text: `두 번째로 큰 지출을 20% 줄이면 <span class="insight-highlight">${formatCurrency(secondExpenseAmount * 0.2)}</span> 추가 저축 가능`,
                        type: 'tip'
                    });
                }
            }

            // 인사이트 렌더링
            const insightsHtml = insights.map(insight => `
                <div class="insight-item">
                    <span class="insight-icon">${insight.icon}</span>
                    <div class="insight-text">${insight.text}</div>
                </div>
            `).join('');

            document.getElementById('cashflowInsights').innerHTML = insightsHtml || 
                '<div style="text-align:center;color:var(--gray-500);">데이터가 충분하지 않습니다</div>';
        }

        // 자산 분포 업데이트 (임시)
        function updateAssetDistribution(totalAssets) {
            // 임시로 카테고리별로 분류
            const web3Income = transactions
                .filter(t => t.type === 'income' && 
                    ['Kaito yapping', '텔레그램 야핑', '에어드랍', '테스트넷'].includes(t.category))
                .reduce((sum, t) => sum + t.amount, 0);
            
            const investmentIncome = transactions
                .filter(t => t.type === 'income' && 
                    ['스테이킹', 'NFT 판매'].includes(t.category))
                .reduce((sum, t) => sum + t.amount, 0);
            
            const bankIncome = transactions
                .filter(t => t.type === 'income' && 
                    ['기타 수입'].includes(t.category))
                .reduce((sum, t) => sum + t.amount, 0);

            const total = web3Income + investmentIncome + bankIncome || 1; // 0으로 나누기 방지

            const web3Percent = ((web3Income / total) * 100).toFixed(1);
            const investmentPercent = ((investmentIncome / total) * 100).toFixed(1);
            const bankPercent = ((bankIncome / total) * 100).toFixed(1);

            // Web3
            document.getElementById('web3Bar').style.width = web3Percent + '%';
            document.getElementById('web3Percent').textContent = web3Percent + '%';
            document.getElementById('web3Amount').textContent = formatCurrency(web3Income);

            // 투자
            document.getElementById('investmentBar').style.width = investmentPercent + '%';
            document.getElementById('investmentPercent').textContent = investmentPercent + '%';
            document.getElementById('investmentAmount').textContent = formatCurrency(investmentIncome);

            // 은행
            document.getElementById('bankBar').style.width = bankPercent + '%';
            document.getElementById('bankPercent').textContent = bankPercent + '%';
            document.getElementById('bankAmount').textContent = formatCurrency(bankIncome);
        }

        // 통화 포맷 함수
        function formatCurrency(amount) {
            const absAmount = Math.abs(amount);
            
            if (absAmount >= 100000000) {
                // 억 단위
                return `${(amount / 100000000).toFixed(1)}억원`;
            } else if (absAmount >= 10000) {
                // 만 단위
                return `${(amount / 10000).toFixed(0)}만원`;
            } else {
                // 원 단위
                return `${amount.toLocaleString()}원`;
            }
        }

        // ===== 고정 항목 관리 함수들 =====

        // 고정 항목 저장
        function saveRecurringItems() {
            localStorage.setItem('web3_recurring_items', JSON.stringify(recurringItems));
        }

        // 고정 항목 표시
        function displayRecurringItems() {
            const incomeItems = recurringItems.filter(item => item.type === 'income');
            const expenseItems = recurringItems.filter(item => item.type === 'expense');

            // 고정 수입 표시
            displayRecurringList('recurringIncomeList', incomeItems, 'income');
            
            // 고정 지출 표시
            displayRecurringList('recurringExpenseList', expenseItems, 'expense');

            // 합계 업데이트
            updateRecurringSummary();
        }

        // 고정 항목 리스트 렌더링
        function displayRecurringList(containerId, items, type) {
            const container = document.getElementById(containerId);
            
            if (items.length === 0) {
                container.innerHTML = `
                    <div class="recurring-empty">
                        <div class="recurring-empty-icon">📭</div>
                        <div>등록된 고정 ${type === 'income' ? '수입' : '지출'}이 없습니다</div>
                    </div>
                `;
                return;
            }

            const html = items.map(item => {
                const nextDate = calculateNextDate(item);
                const frequencyText = getFrequencyText(item.frequency, item.dayOfMonth);
                
                return `
                    <div class="recurring-item ${type}">
                        <div class="recurring-item-left">
                            <div class="recurring-item-name">${item.category}</div>
                            <div class="recurring-item-details">
                                <div class="recurring-detail">
                                    <span>🔄</span>
                                    <span>${frequencyText}</span>
                                </div>
                                <div class="recurring-detail">
                                    <span>📅</span>
                                    <span>다음: ${nextDate}</span>
                                </div>
                                ${item.description ? `
                                    <div class="recurring-detail">
                                        <span>📝</span>
                                        <span>${item.description}</span>
                                    </div>
                                ` : ''}
                            </div>
                        </div>
                        <div class="recurring-item-right">
                            <div class="recurring-amount ${type}">${formatCurrency(item.amount)}</div>
                            <div class="recurring-item-actions">
                                <button class="btn-icon-small" onclick="editRecurringItem(${item.id})" title="수정">
                                    ✏️
                                </button>
                                <button class="btn-icon-small delete" onclick="deleteRecurringItem(${item.id})" title="삭제">
                                    🗑️
                                </button>
                            </div>
                        </div>
                    </div>
                `;
            }).join('');

            container.innerHTML = html;
        }

        // 다음 예정일 계산
        function calculateNextDate(item) {
            const today = new Date();
            let nextDate = new Date();

            if (item.frequency === 'monthly') {
                // 이번 달의 해당 일자
                nextDate.setDate(item.dayOfMonth);
                
                // 이미 지났으면 다음 달로
                if (nextDate <= today) {
                    nextDate.setMonth(nextDate.getMonth() + 1);
                }
            } else if (item.frequency === 'weekly') {
                // 주간 반복 (간단 구현)
                const daysUntilNext = (item.dayOfMonth - today.getDay() + 7) % 7;
                nextDate.setDate(today.getDate() + (daysUntilNext === 0 ? 7 : daysUntilNext));
            } else if (item.frequency === 'daily') {
                nextDate.setDate(today.getDate() + 1);
            }

            return nextDate.toLocaleDateString('ko-KR', { year: 'numeric', month: 'long', day: 'numeric' });
        }

        // 반복 주기 텍스트
        function getFrequencyText(frequency, dayOfMonth) {
            if (frequency === 'monthly') {
                return `매월 ${dayOfMonth}일`;
            } else if (frequency === 'weekly') {
                const days = ['일', '월', '화', '수', '목', '금', '토'];
                return `매주 ${days[dayOfMonth]}요일`;
            } else if (frequency === 'daily') {
                return '매일';
            }
            return frequency;
        }

        // 합계 업데이트
        function updateRecurringSummary() {
            const totalIncome = recurringItems
                .filter(item => item.type === 'income')
                .reduce((sum, item) => sum + item.amount, 0);
            
            const totalExpense = recurringItems
                .filter(item => item.type === 'expense')
                .reduce((sum, item) => sum + item.amount, 0);
            
            const profit = totalIncome - totalExpense;

            document.getElementById('totalRecurringIncome').textContent = `월 ${formatCurrency(totalIncome)}`;
            document.getElementById('totalRecurringExpense').textContent = `월 ${formatCurrency(totalExpense)}`;
            
            document.getElementById('summaryIncome').textContent = `월 ${formatCurrency(totalIncome)}`;
            document.getElementById('summaryExpense').textContent = `월 ${formatCurrency(totalExpense)}`;
            document.getElementById('summaryProfit').textContent = `${profit >= 0 ? '+' : ''}${formatCurrency(profit)}`;
        }

        // 모달 열기
        function openRecurringModal(type) {
            document.getElementById('recurringType').value = type;
            document.getElementById('recurringEditId').value = '';
            document.getElementById('recurringModalTitle').textContent = 
                `고정 ${type === 'income' ? '수입' : '지출'} 추가`;
            
            // 폼 초기화
            document.getElementById('recurringCategory').value = '';
            document.getElementById('recurringAmount').value = '';
            document.getElementById('recurringFrequency').value = 'monthly';
            document.getElementById('recurringDay').value = '';
            document.getElementById('recurringDescription').value = '';
            
            document.getElementById('recurringModal').classList.add('active');
        }

        // 모달 닫기
        function closeRecurringModal() {
            document.getElementById('recurringModal').classList.remove('active');
        }

        // 오버레이 클릭으로 닫기
        function closeModalOnOverlay(event) {
            if (event.target.classList.contains('modal-overlay')) {
                closeRecurringModal();
            }
        }

        // 고정 항목 저장
        function saveRecurringItem(event) {
            event.preventDefault();
            
            const editId = document.getElementById('recurringEditId').value;
            const type = document.getElementById('recurringType').value;
            const category = document.getElementById('recurringCategory').value;
            const amount = parseFloat(document.getElementById('recurringAmount').value);
            const frequency = document.getElementById('recurringFrequency').value;
            const dayOfMonth = parseInt(document.getElementById('recurringDay').value);
            const description = document.getElementById('recurringDescription').value;

            if (!category || !amount || !dayOfMonth) {
                alert('필수 항목을 모두 입력해주세요.');
                return;
            }

            const item = {
                id: editId ? parseInt(editId) : Date.now(),
                type,
                category,
                amount,
                frequency,
                dayOfMonth,
                description,
                active: true,
                createdAt: editId ? 
                    recurringItems.find(i => i.id === parseInt(editId))?.createdAt : 
                    new Date().toISOString()
            };

            if (editId) {
                // 수정
                const index = recurringItems.findIndex(i => i.id === parseInt(editId));
                if (index !== -1) {
                    recurringItems[index] = item;
                }
            } else {
                // 추가
                recurringItems.push(item);
            }

            saveRecurringItems();
            displayRecurringItems();
            closeRecurringModal();
            alert(`고정 ${type === 'income' ? '수입' : '지출'}이 ${editId ? '수정' : '추가'}되었습니다!`);
        }

        // 고정 항목 수정
        function editRecurringItem(id) {
            const item = recurringItems.find(i => i.id === id);
            if (!item) return;

            document.getElementById('recurringEditId').value = item.id;
            document.getElementById('recurringType').value = item.type;
            document.getElementById('recurringModalTitle').textContent = 
                `고정 ${item.type === 'income' ? '수입' : '지출'} 수정`;
            
            document.getElementById('recurringCategory').value = item.category;
            document.getElementById('recurringAmount').value = item.amount;
            document.getElementById('recurringFrequency').value = item.frequency;
            document.getElementById('recurringDay').value = item.dayOfMonth;
            document.getElementById('recurringDescription').value = item.description || '';
            
            document.getElementById('recurringModal').classList.add('active');
        }

        // 고정 항목 삭제
        function deleteRecurringItem(id) {
            const item = recurringItems.find(i => i.id === id);
            if (!item) return;

            if (confirm(`'${item.category}'를 삭제하시겠습니까?`)) {
                recurringItems = recurringItems.filter(i => i.id !== id);
                saveRecurringItems();
                displayRecurringItems();
                alert('삭제되었습니다.');
            }
        }

        // 카테고리별 입력 타입 정의
        const categoryInputTypes = {
            'Kaito yapping': 'token',
            '에어드랍': 'token',
            '테스트넷': 'token',
            '스테이킹': 'token',
            'NFT 판매': 'token',
            '텔레그램 야핑': 'flexible',
            '이벤트 참여': 'flexible',
            '기타 수입': 'simple',
            '가스비': 'simple',
            'NFT 구매': 'simple',
            '토큰 구매': 'simple',
            '브릿지': 'simple',
            '거래 수수료': 'simple',
            '기타 지출': 'simple'
        };

        function updateDynamicFields() {
            const category = document.getElementById('category').value;
            const type = document.getElementById('type').value;
            const container = document.getElementById('dynamicFieldsContainer');
            
            const inputType = categoryInputTypes[category];
            
            if (inputType === 'token') {
                container.innerHTML = `
                    <div class="dynamic-fields">
                        <h3>💎 토큰 수령 정보</h3>
                        <div class="form-group">
                            <div>
                                <label>토큰 이름/티커 *</label>
                                <input type="text" id="tokenName" placeholder="예: ARB, STRK">
                                <div class="field-hint">예: Arbitrum (ARB)</div>
                            </div>
                            <div>
                                <label>수령 수량 *</label>
                                <input type="number" id="tokenQuantity" placeholder="0.00" step="0.000001" oninput="calculateTokenValue()">
                                <div class="field-hint">받은 토큰 개수</div>
                            </div>
                            <div>
                                <label>토큰당 가격 ($) *</label>
                                <input type="number" id="tokenPrice" placeholder="0.00" step="0.000001" oninput="calculateTokenValue()">
                                <div class="field-hint">수령 당시 1개당 가격</div>
                            </div>
                            <div>
                                <label>블록체인/네트워크</label>
                                <input type="text" id="blockchain" placeholder="예: Ethereum, Arbitrum">
                                <div class="field-hint">선택사항</div>
                            </div>
                        </div>
                        <div class="calculated-value">
                            <label>총 가치 (자동 계산)</label>
                            <div class="value" id="calculatedValue">$0.00</div>
                        </div>
                    </div>
                `;
            } else if (inputType === 'flexible') {
                container.innerHTML = `
                    <div class="dynamic-fields">
                        <h3>🎯 보상 정보</h3>
                        <div class="form-group">
                            <div>
                                <label>보상 유형 *</label>
                                <select id="rewardType" onchange="updateFlexibleFields()">
                                    <option value="token">토큰</option>
                                    <option value="points">포인트</option>
                                    <option value="cash">현금</option>
                                </select>
                            </div>
                        </div>
                        <div id="flexibleFieldsContainer">
                            <div class="form-group">
                                <div>
                                    <label>토큰 이름/티커 *</label>
                                    <input type="text" id="tokenName" placeholder="예: ARB, STRK">
                                </div>
                                <div>
                                    <label>수령 수량 *</label>
                                    <input type="number" id="tokenQuantity" placeholder="0.00" step="0.000001" oninput="calculateTokenValue()">
                                </div>
                                <div>
                                    <label>토큰당 가격 ($) *</label>
                                    <input type="number" id="tokenPrice" placeholder="0.00" step="0.000001" oninput="calculateTokenValue()">
                                </div>
                                <div>
                                    <label>블록체인/네트워크</label>
                                    <input type="text" id="blockchain" placeholder="예: Ethereum">
                                </div>
                            </div>
                            <div class="calculated-value">
                                <label>총 가치 (자동 계산)</label>
                                <div class="value" id="calculatedValue">$0.00</div>
                            </div>
                        </div>
                    </div>
                `;
            } else {
                container.innerHTML = `
                    <div class="dynamic-fields">
                        <h3>💰 금액 정보</h3>
                        <div class="form-group">
                            <div style="grid-column: 1 / -1;">
                                <label>금액 ($) *</label>
                                <input type="number" id="amount" placeholder="0.00" step="0.01">
                            </div>
                        </div>
                    </div>
                `;
            }
        }

        function updateFlexibleFields() {
            const rewardType = document.getElementById('rewardType').value;
            const container = document.getElementById('flexibleFieldsContainer');
            
            if (rewardType === 'token') {
                container.innerHTML = `
                    <div class="form-group">
                        <div>
                            <label>토큰 이름/티커 *</label>
                            <input type="text" id="tokenName" placeholder="예: ARB, STRK">
                        </div>
                        <div>
                            <label>수령 수량 *</label>
                            <input type="number" id="tokenQuantity" placeholder="0.00" step="0.000001" oninput="calculateTokenValue()">
                        </div>
                        <div>
                            <label>토큰당 가격 ($) *</label>
                            <input type="number" id="tokenPrice" placeholder="0.00" step="0.000001" oninput="calculateTokenValue()">
                        </div>
                        <div>
                            <label>블록체인/네트워크</label>
                            <input type="text" id="blockchain" placeholder="예: Ethereum">
                        </div>
                    </div>
                    <div class="calculated-value">
                        <label>총 가치 (자동 계산)</label>
                        <div class="value" id="calculatedValue">$0.00</div>
                    </div>
                `;
            } else if (rewardType === 'points') {
                container.innerHTML = `
                    <div class="form-group">
                        <div>
                            <label>포인트 수량 *</label>
                            <input type="number" id="pointQuantity" placeholder="0">
                        </div>
                        <div>
                            <label>예상 가치 ($)</label>
                            <input type="number" id="amount" placeholder="0.00" step="0.01">
                            <div class="field-hint">현재 예상되는 가치 (선택사항)</div>
                        </div>
                    </div>
                `;
            } else {
                container.innerHTML = `
                    <div class="form-group">
                        <div style="grid-column: 1 / -1;">
                            <label>금액 ($) *</label>
                            <input type="number" id="amount" placeholder="0.00" step="0.01">
                        </div>
                    </div>
                `;
            }
        }

        function calculateTokenValue() {
            const quantity = parseFloat(document.getElementById('tokenQuantity')?.value || 0);
            const price = parseFloat(document.getElementById('tokenPrice')?.value || 0);
            const totalValue = quantity * price;
            
            const valueElement = document.getElementById('calculatedValue');
            if (valueElement) {
                valueElement.textContent = `$${totalValue.toFixed(2)}`;
            }
        }

        // 페이지 로드 시 초기 필드 설정
        window.addEventListener('DOMContentLoaded', function() {
            updateDynamicFields();
        });

        function setDateFilter(filter) {
            currentDateFilter = filter;
            
            // 버튼 활성화 상태 변경
            document.querySelectorAll('.date-filter-btn').forEach(btn => {
                btn.classList.remove('active');
            });
            event.target.classList.add('active');
            
            updateDisplay();
        }

        function getFilteredTransactionsByDate() {
            const now = new Date();
            const startOfWeek = new Date(now);
            startOfWeek.setDate(now.getDate() - now.getDay());
            startOfWeek.setHours(0, 0, 0, 0);
            
            const startOfMonth = new Date(now.getFullYear(), now.getMonth(), 1);
            const startOfLastMonth = new Date(now.getFullYear(), now.getMonth() - 1, 1);
            const endOfLastMonth = new Date(now.getFullYear(), now.getMonth(), 0);

            return transactions.filter(t => {
                const transactionDate = new Date(t.date);
                
                switch(currentDateFilter) {
                    case 'week':
                        return transactionDate >= startOfWeek;
                    case 'month':
                        return transactionDate >= startOfMonth;
                    case 'lastMonth':
                        return transactionDate >= startOfLastMonth && transactionDate <= endOfLastMonth;
                    default:
                        return true;
                }
            });
        }

        function switchTab(tabName) {
            // 모든 탭 버튼과 컨텐츠 비활성화
            document.querySelectorAll('.tab-button').forEach(btn => btn.classList.remove('active'));
            document.querySelectorAll('.tab-content').forEach(content => content.classList.remove('active'));
            
            // 선택된 탭 활성화
            event.target.classList.add('active');
            document.getElementById(tabName).classList.add('active');
        }

        function addTransaction() {
            const type = document.getElementById('type').value;
            const category = document.getElementById('category').value;
            const date = document.getElementById('date').value;
            const title = document.getElementById('title').value;
            const description = document.getElementById('description').value;
            
            const inputType = categoryInputTypes[category];
            let amount = 0;
            let tokenData = null;

            // 입력 타입에 따른 데이터 수집
            if (inputType === 'token') {
                const tokenName = document.getElementById('tokenName')?.value;
                const quantity = parseFloat(document.getElementById('tokenQuantity')?.value || 0);
                const price = parseFloat(document.getElementById('tokenPrice')?.value || 0);
                const blockchain = document.getElementById('blockchain')?.value;

                if (!tokenName || !quantity || !price) {
                    alert('토큰 이름, 수량, 가격을 모두 입력해주세요.');
                    return;
                }

                amount = quantity * price;
                tokenData = { tokenName, quantity, price, blockchain, type: 'token' };
            } else if (inputType === 'flexible') {
                const rewardType = document.getElementById('rewardType').value;
                
                if (rewardType === 'token') {
                    const tokenName = document.getElementById('tokenName')?.value;
                    const quantity = parseFloat(document.getElementById('tokenQuantity')?.value || 0);
                    const price = parseFloat(document.getElementById('tokenPrice')?.value || 0);
                    const blockchain = document.getElementById('blockchain')?.value;

                    if (!tokenName || !quantity || !price) {
                        alert('토큰 이름, 수량, 가격을 모두 입력해주세요.');
                        return;
                    }

                    amount = quantity * price;
                    tokenData = { tokenName, quantity, price, blockchain, type: 'token' };
                } else if (rewardType === 'points') {
                    const pointQuantity = parseFloat(document.getElementById('pointQuantity')?.value || 0);
                    const pointValue = parseFloat(document.getElementById('amount')?.value || 0);

                    if (!pointQuantity) {
                        alert('포인트 수량을 입력해주세요.');
                        return;
                    }

                    amount = pointValue;
                    tokenData = { pointQuantity, type: 'points' };
                } else {
                    amount = parseFloat(document.getElementById('amount')?.value || 0);
                }
            } else {
                amount = parseFloat(document.getElementById('amount')?.value || 0);
            }

            if (!amount || amount <= 0) {
                alert('올바른 금액을 입력해주세요.');
                return;
            }

            if (!date) {
                alert('날짜를 선택해주세요.');
                return;
            }

            if (!title) {
                alert('제목을 입력해주세요.');
                return;
            }

            // 수정 모드인 경우
            if (editingTransactionId) {
                const index = transactions.findIndex(t => t.id === editingTransactionId);
                if (index !== -1) {
                    transactions[index] = {
                        id: editingTransactionId,
                        type,
                        category,
                        amount,
                        date,
                        title,
                        description,
                        tokenData
                    };
                    alert('거래가 수정되었습니다!');
                }
                editingTransactionId = null;
                document.getElementById('editModeBanner').classList.remove('active');
                document.querySelector('.input-section').classList.remove('edit-mode');
            } else {
                // 새로운 거래 추가
                const transaction = {
                    id: Date.now(),
                    type,
                    category,
                    amount,
                    date,
                    title,
                    description,
                    tokenData
                };
                transactions.unshift(transaction);
                alert('거래가 추가되었습니다!');
            }

            saveTransactions();
            updateDisplay();
            clearForm();
        }

        function editTransaction(id) {
            const transaction = transactions.find(t => t.id === id);
            if (!transaction) return;

            // 수정 모드 활성화
            editingTransactionId = id;
            document.getElementById('editModeBanner').classList.add('active');
            document.querySelector('.input-section').classList.add('edit-mode');

            // 대시보드 탭으로 이동
            document.querySelectorAll('.tab-button').forEach(btn => btn.classList.remove('active'));
            document.querySelectorAll('.tab-content').forEach(content => content.classList.remove('active'));
            document.querySelector('.tab-button').classList.add('active');
            document.getElementById('dashboard').classList.add('active');

            // 폼에 데이터 채우기
            document.getElementById('type').value = transaction.type;
            document.getElementById('category').value = transaction.category;
            document.getElementById('date').value = transaction.date;
            document.getElementById('title').value = transaction.title;
            document.getElementById('description').value = transaction.description || '';

            // 동적 필드 업데이트
            updateDynamicFields();

            // 토큰 데이터가 있으면 채우기
            if (transaction.tokenData) {
                setTimeout(() => {
                    if (transaction.tokenData.type === 'token') {
                        document.getElementById('tokenName').value = transaction.tokenData.tokenName || '';
                        document.getElementById('tokenQuantity').value = transaction.tokenData.quantity || '';
                        document.getElementById('tokenPrice').value = transaction.tokenData.price || '';
                        if (document.getElementById('blockchain')) {
                            document.getElementById('blockchain').value = transaction.tokenData.blockchain || '';
                        }
                        calculateTokenValue();
                    } else if (transaction.tokenData.type === 'points') {
                        if (document.getElementById('rewardType')) {
                            document.getElementById('rewardType').value = 'points';
                            updateFlexibleFields();
                            setTimeout(() => {
                                document.getElementById('pointQuantity').value = transaction.tokenData.pointQuantity || '';
                                document.getElementById('amount').value = transaction.amount || '';
                            }, 100);
                        }
                    }
                }, 100);
            } else {
                setTimeout(() => {
                    if (document.getElementById('amount')) {
                        document.getElementById('amount').value = transaction.amount;
                    }
                }, 100);
            }

            // 입력 섹션으로 스크롤
            document.querySelector('.input-section').scrollIntoView({ behavior: 'smooth' });
        }

        function cancelEdit() {
            editingTransactionId = null;
            document.getElementById('editModeBanner').classList.remove('active');
            document.querySelector('.input-section').classList.remove('edit-mode');
            clearForm();
        }

        function deleteTransaction(id) {
            if (confirm('이 거래를 삭제하시겠습니까?')) {
                transactions = transactions.filter(t => t.id !== id);
                saveTransactions();
                updateDisplay();
                alert('거래가 삭제되었습니다.');
            }
        }

        function clearAllData() {
            if (confirm('정말로 모든 데이터를 삭제하시겠습니까? 이 작업은 되돌릴 수 없습니다.')) {
                if (confirm('다시 한 번 확인합니다. 모든 거래 내역이 삭제됩니다.')) {
                    transactions = [];
                    saveTransactions();
                    updateDisplay();
                    alert('모든 데이터가 삭제되었습니다.');
                }
            }
        }

        function exportToCSV() {
            if (transactions.length === 0) {
                alert('내보낼 데이터가 없습니다.');
                return;
            }

            const csvContent = [
                ['날짜', '유형', '카테고리', '제목', '설명', '금액', '토큰명', '수량', '토큰가격', '블록체인'],
                ...transactions.map(t => {
                    const tokenInfo = t.tokenData || {};
                    return [
                        t.date,
                        t.type === 'income' ? '수입' : '지출',
                        t.category,
                        t.title || '',
                        t.description || '',
                        t.amount,
                        tokenInfo.tokenName || '',
                        tokenInfo.quantity || '',
                        tokenInfo.price || '',
                        tokenInfo.blockchain || ''
                    ];
                })
            ].map(row => row.join(',')).join('\n');

            const BOM = '\uFEFF';
            const blob = new Blob([BOM + csvContent], { type: 'text/csv;charset=utf-8;' });
            const link = document.createElement('a');
            const url = URL.createObjectURL(blob);
            
            link.setAttribute('href', url);
            link.setAttribute('download', `web3-budget-${new Date().toISOString().split('T')[0]}.csv`);
            link.style.visibility = 'hidden';
            
            document.body.appendChild(link);
            link.click();
            document.body.removeChild(link);
        }

        function saveTransactions() {
            localStorage.setItem('web3Transactions', JSON.stringify(transactions));
        }

        function clearForm() {
            document.getElementById('title').value = '';
            document.getElementById('description').value = '';
            document.getElementById('date').valueAsDate = new Date();
            updateDynamicFields(); // 동적 필드 초기화
        }

        function updateDisplay() {
            updateSummary();
            updateStats();
            displayTransactions();
            updateCategoryFilter();
            updateCategoryBreakdown();
            updateHomePageData(); // 홈 페이지도 함께 업데이트
            updateCharts(); // 차트 업데이트
        }

        function updateStats() {
            const filtered = getFilteredTransactionsByDate();
            const incomeTransactions = filtered.filter(t => t.type === 'income');
            
            // 총 거래 건수
            document.getElementById('totalTransactions').textContent = filtered.length;
            
            // 평균 수입
            const avgIncome = incomeTransactions.length > 0 
                ? incomeTransactions.reduce((sum, t) => sum + t.amount, 0) / incomeTransactions.length 
                : 0;
            document.getElementById('avgIncome').textContent = `$${avgIncome.toFixed(2)}`;
            
            // 최고 수익 카테고리
            const categoryMap = {};
            incomeTransactions.forEach(t => {
                categoryMap[t.category] = (categoryMap[t.category] || 0) + t.amount;
            });
            const topCategory = Object.entries(categoryMap).sort((a, b) => b[1] - a[1])[0];
            document.getElementById('topCategory').textContent = topCategory ? topCategory[0] : '-';
            
            // 최근 거래일
            if (filtered.length > 0) {
                const lastDate = new Date(filtered[0].date);
                document.getElementById('lastTransactionDate').textContent = lastDate.toLocaleDateString('ko-KR');
            } else {
                document.getElementById('lastTransactionDate').textContent = '-';
            }
        }

        function updateCategoryBreakdown() {
            const filtered = getFilteredTransactionsByDate();
            const incomeTransactions = filtered.filter(t => t.type === 'income');
            const categoryMap = {};

            incomeTransactions.forEach(t => {
                if (!categoryMap[t.category]) {
                    categoryMap[t.category] = { amount: 0, count: 0, transactions: [] };
                }
                categoryMap[t.category].amount += t.amount;
                categoryMap[t.category].count += 1;
                categoryMap[t.category].transactions.push(t);
            });

            const sortedCategories = Object.entries(categoryMap)
                .sort((a, b) => b[1].amount - a[1].amount);

            const getCategoryClass = (category) => {
                if (category.includes('Kaito')) return 'kaito';
                if (category.includes('텔레그램')) return 'telegram';
                if (category.includes('이벤트')) return 'event';
                return 'other';
            };

            const breakdownHTML = sortedCategories.map(([category, data]) => {
                const recentTransactions = data.transactions.slice(0, 3);
                const previewHTML = recentTransactions.map(t => `
                    <div class="preview-item">
                        <div class="preview-item-title">${t.title}</div>
                        <div class="preview-item-amount">$${t.amount.toFixed(2)}</div>
                    </div>
                `).join('');
                
                const moreText = data.count > 3 ? `<div class="preview-more">+${data.count - 3}건 더보기</div>` : '';
                
                return `
                    <div class="category-item ${getCategoryClass(category)}" onclick="showCategoryDetail('${category}')">
                        <div class="category-header">
                            <div>
                                <div class="category-name">${category}</div>
                                <div class="category-count">${data.count}건</div>
                            </div>
                            <div class="category-amount">$${data.amount.toFixed(2)}</div>
                        </div>
                        <div class="category-preview">
                            ${previewHTML}
                            ${moreText}
                        </div>
                    </div>
                `;
            }).join('');

            document.getElementById('categoryBreakdown').innerHTML = breakdownHTML || 
                '<p style="text-align:center;color:#999;padding:20px;grid-column:1/-1;">선택한 기간에 수입 내역이 없습니다.</p>';
        }

        function showCategoryDetail(category) {
            const filtered = getFilteredTransactionsByDate();
            const categoryTransactions = filtered.filter(t => 
                t.type === 'income' && t.category === category
            );

            const totalAmount = categoryTransactions.reduce((sum, t) => sum + t.amount, 0);

            document.getElementById('modalTitle').textContent = `${category} (총 $${totalAmount.toFixed(2)})`;

            const modalContent = categoryTransactions.map(t => {
                let tokenInfo = '';
                if (t.tokenData) {
                    if (t.tokenData.type === 'token') {
                        tokenInfo = `
                            <div style="margin-top:8px;padding:8px;background:#f0f4ff;border-radius:6px;">
                                <span class="token-badge">${t.tokenData.tokenName}</span>
                                <span style="margin-left:8px;color:#667eea;font-weight:600;">
                                    ${t.tokenData.quantity.toLocaleString()} × $${t.tokenData.price.toFixed(4)}
                                </span>
                                ${t.tokenData.blockchain ? `<div style="font-size:0.85em;color:#666;margin-top:4px;">네트워크: ${t.tokenData.blockchain}</div>` : ''}
                            </div>
                        `;
                    } else if (t.tokenData.type === 'points') {
                        tokenInfo = `
                            <div style="margin-top:8px;padding:8px;background:#f0f4ff;border-radius:6px;">
                                🎯 <span style="color:#667eea;font-weight:600;">${t.tokenData.pointQuantity.toLocaleString()} 포인트</span>
                            </div>
                        `;
                    }
                }
                
                return `
                    <div class="modal-transaction">
                        <div class="modal-transaction-title">${t.title || '제목 없음'}</div>
                        ${tokenInfo}
                        ${t.description ? `<div class="modal-transaction-desc">${t.description}</div>` : ''}
                        <div class="modal-transaction-footer">
                            <span class="modal-transaction-date">${new Date(t.date).toLocaleDateString('ko-KR')}</span>
                            <span class="modal-transaction-amount">$${t.amount.toFixed(2)}</span>
                        </div>
                    </div>
                `;
            }).join('');

            document.getElementById('modalBody').innerHTML = modalContent;
            document.getElementById('categoryModal').classList.add('active');
        }

        function closeModal() {
            document.getElementById('categoryModal').classList.remove('active');
        }

        // 모달 외부 클릭시 닫기
        document.getElementById('categoryModal').addEventListener('click', function(e) {
            if (e.target === this) {
                closeModal();
            }
        });

        function updateSummary() {
            const filtered = getFilteredTransactionsByDate();
            
            const totalIncome = filtered
                .filter(t => t.type === 'income')
                .reduce((sum, t) => sum + t.amount, 0);

            const totalExpense = filtered
                .filter(t => t.type === 'expense')
                .reduce((sum, t) => sum + t.amount, 0);

            const netProfit = totalIncome - totalExpense;

            document.getElementById('totalIncome').textContent = `$${totalIncome.toFixed(2)}`;
            document.getElementById('totalExpense').textContent = `$${totalExpense.toFixed(2)}`;
            document.getElementById('netProfit').textContent = `$${netProfit.toFixed(2)}`;
        }

        function displayTransactions() {
            const filterType = document.getElementById('filterType').value;
            const filterCategory = document.getElementById('filterCategory').value;
            const searchQuery = document.getElementById('searchInput').value.toLowerCase();

            let filtered = transactions;

            if (filterType !== 'all') {
                filtered = filtered.filter(t => t.type === filterType);
            }

            if (filterCategory !== 'all') {
                filtered = filtered.filter(t => t.category === filterCategory);
            }

            if (searchQuery) {
                filtered = filtered.filter(t => 
                    (t.title && t.title.toLowerCase().includes(searchQuery)) ||
                    (t.description && t.description.toLowerCase().includes(searchQuery)) ||
                    (t.tokenData?.tokenName && t.tokenData.tokenName.toLowerCase().includes(searchQuery))
                );
            }

            const listHTML = filtered.map(t => {
                let tokenInfo = '';
                if (t.tokenData) {
                    if (t.tokenData.type === 'token') {
                        tokenInfo = `
                            <div style="margin-top:5px;font-size:0.9em;color:#667eea;">
                                <span class="token-badge">${t.tokenData.tokenName}</span>
                                ${t.tokenData.quantity.toLocaleString()} × $${t.tokenData.price.toFixed(4)}
                                ${t.tokenData.blockchain ? ` · ${t.tokenData.blockchain}` : ''}
                            </div>
                        `;
                    } else if (t.tokenData.type === 'points') {
                        tokenInfo = `
                            <div style="margin-top:5px;font-size:0.9em;color:#667eea;">
                                🎯 ${t.tokenData.pointQuantity.toLocaleString()} 포인트
                            </div>
                        `;
                    }
                }
                
                return `
                    <div class="transaction-item ${t.type}">
                        <div class="transaction-info">
                            <span class="transaction-category">${t.category}</span>
                            <div style="margin-top:8px;"><strong>${t.title || '제목 없음'}</strong></div>
                            ${tokenInfo}
                            ${t.description ? `<div class="transaction-description">${t.description}</div>` : ''}
                        </div>
                        <span class="transaction-date">${new Date(t.date).toLocaleDateString('ko-KR')}</span>
                        <span class="transaction-amount ${t.type}">
                            ${t.type === 'income' ? '+' : '-'}$${t.amount.toFixed(2)}
                        </span>
                        <button class="btn btn-edit" onclick="event.stopPropagation(); editTransaction(${t.id})">수정</button>
                        <button class="btn btn-delete" onclick="event.stopPropagation(); deleteTransaction(${t.id})">삭제</button>
                    </div>
                `;
            }).join('');

            document.getElementById('transactionList').innerHTML = listHTML || 
                '<p style="text-align:center;color:#999;padding:20px;">거래 내역이 없습니다.</p>';
        }

        function updateCategoryFilter() {
            const categories = [...new Set(transactions.map(t => t.category))];
            const filterSelect = document.getElementById('filterCategory');
            
            filterSelect.innerHTML = '<option value="all">모든 카테고리</option>';
            categories.forEach(cat => {
                filterSelect.innerHTML += `<option value="${cat}">${cat}</option>`;
            });
        }

        function filterTransactions() {
            displayTransactions();
        }

        // 초기 표시
        updateDisplay();
    </script>
</body>
</html>
